"use strict";var Nh=Object.defineProperty;var Ih=(s,t,e)=>t in s?Nh(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var Ft=(s,t,e)=>Ih(s,typeof t!="symbol"?t+"":t,e);const U=require("electron"),y=require("path"),v=require("fs"),Pe=require("events"),ji=require("stream"),qi=require("string_decoder"),Ki=require("assert"),vh=require("buffer"),Rn=require("zlib"),Ah=require("process"),Mh=require("util"),Ch=require("crypto"),xh=require("child_process"),Ph=require("http");var Is=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};const or=new Map([["C","cwd"],["f","file"],["z","gzip"],["P","preservePaths"],["U","unlink"],["strip-components","strip"],["stripComponents","strip"],["keep-newer","newer"],["keepNewer","newer"],["keep-newer-files","newer"],["keepNewerFiles","newer"],["k","keep"],["keep-existing","keep"],["keepExisting","keep"],["m","noMtime"],["no-mtime","noMtime"],["p","preserveOwner"],["L","follow"],["h","follow"]]);var Bh=s=>s?Object.keys(s).map(t=>[or.has(t)?or.get(t):t,s[t]]).reduce((t,e)=>(t[e[0]]=e[1],t),Object.create(null)):{},vs={};const lr=typeof process=="object"&&process?process:{stdout:null,stderr:null},Fh=Pe,ar=ji,$h=qi,cr=$h.StringDecoder,ht=Symbol("EOF"),ot=Symbol("maybeEmitEnd"),bt=Symbol("emittedEnd"),Fe=Symbol("emittingEnd"),pe=Symbol("emittedError"),$e=Symbol("closed"),ur=Symbol("read"),Ue=Symbol("flush"),fr=Symbol("flushChunk"),B=Symbol("encoding"),lt=Symbol("decoder"),ke=Symbol("flowing"),Ee=Symbol("paused"),ee=Symbol("resume"),R=Symbol("buffer"),J=Symbol("pipes"),T=Symbol("bufferLength"),Ps=Symbol("bufferPush"),Bs=Symbol("bufferShift"),I=Symbol("objectMode"),b=Symbol("destroyed"),Fs=Symbol("error"),$s=Symbol("emitData"),dr=Symbol("emitEnd"),Us=Symbol("emitEnd2"),at=Symbol("async"),ks=Symbol("abort"),ze=Symbol("aborted"),$t=Symbol("signal"),ye=s=>Promise.resolve().then(s),bn=Is._MP_NO_ITERATOR_SYMBOLS_!=="1",mr=bn&&Symbol.asyncIterator||Symbol("asyncIterator not implemented"),pr=bn&&Symbol.iterator||Symbol("iterator not implemented"),Uh=s=>s==="end"||s==="finish"||s==="prefinish",kh=s=>s instanceof ArrayBuffer||typeof s=="object"&&s.constructor&&s.constructor.name==="ArrayBuffer"&&s.byteLength>=0,zh=s=>!Buffer.isBuffer(s)&&ArrayBuffer.isView(s);let _n=class{constructor(t,e,i){this.src=t,this.dest=e,this.opts=i,this.ondrain=()=>t[ee](),e.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(){}end(){this.unpipe(),this.opts.end&&this.dest.end()}},Gh=class extends _n{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(t,e,i){super(t,e,i),this.proxyErrors=r=>e.emit("error",r),t.on("error",this.proxyErrors)}},Hh=class On extends ar{constructor(t){super(),this[ke]=!1,this[Ee]=!1,this[J]=[],this[R]=[],this[I]=t&&t.objectMode||!1,this[I]?this[B]=null:this[B]=t&&t.encoding||null,this[B]==="buffer"&&(this[B]=null),this[at]=t&&!!t.async||!1,this[lt]=this[B]?new cr(this[B]):null,this[ht]=!1,this[bt]=!1,this[Fe]=!1,this[$e]=!1,this[pe]=null,this.writable=!0,this.readable=!0,this[T]=0,this[b]=!1,t&&t.debugExposeBuffer===!0&&Object.defineProperty(this,"buffer",{get:()=>this[R]}),t&&t.debugExposePipes===!0&&Object.defineProperty(this,"pipes",{get:()=>this[J]}),this[$t]=t&&t.signal,this[ze]=!1,this[$t]&&(this[$t].addEventListener("abort",()=>this[ks]()),this[$t].aborted&&this[ks]())}get bufferLength(){return this[T]}get encoding(){return this[B]}set encoding(t){if(this[I])throw new Error("cannot set encoding in objectMode");if(this[B]&&t!==this[B]&&(this[lt]&&this[lt].lastNeed||this[T]))throw new Error("cannot change encoding");this[B]!==t&&(this[lt]=t?new cr(t):null,this[R].length&&(this[R]=this[R].map(e=>this[lt].write(e)))),this[B]=t}setEncoding(t){this.encoding=t}get objectMode(){return this[I]}set objectMode(t){this[I]=this[I]||!!t}get async(){return this[at]}set async(t){this[at]=this[at]||!!t}[ks](){this[ze]=!0,this.emit("abort",this[$t].reason),this.destroy(this[$t].reason)}get aborted(){return this[ze]}set aborted(t){}write(t,e,i){if(this[ze])return!1;if(this[ht])throw new Error("write after end");if(this[b])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;typeof e=="function"&&(i=e,e="utf8"),e||(e="utf8");const r=this[at]?ye:n=>n();return!this[I]&&!Buffer.isBuffer(t)&&(zh(t)?t=Buffer.from(t.buffer,t.byteOffset,t.byteLength):kh(t)?t=Buffer.from(t):typeof t!="string"&&(this.objectMode=!0)),this[I]?(this.flowing&&this[T]!==0&&this[Ue](!0),this.flowing?this.emit("data",t):this[Ps](t),this[T]!==0&&this.emit("readable"),i&&r(i),this.flowing):t.length?(typeof t=="string"&&!(e===this[B]&&!this[lt].lastNeed)&&(t=Buffer.from(t,e)),Buffer.isBuffer(t)&&this[B]&&(t=this[lt].write(t)),this.flowing&&this[T]!==0&&this[Ue](!0),this.flowing?this.emit("data",t):this[Ps](t),this[T]!==0&&this.emit("readable"),i&&r(i),this.flowing):(this[T]!==0&&this.emit("readable"),i&&r(i),this.flowing)}read(t){if(this[b])return null;if(this[T]===0||t===0||t>this[T])return this[ot](),null;this[I]&&(t=null),this[R].length>1&&!this[I]&&(this.encoding?this[R]=[this[R].join("")]:this[R]=[Buffer.concat(this[R],this[T])]);const e=this[ur](t||null,this[R][0]);return this[ot](),e}[ur](t,e){return t===e.length||t===null?this[Bs]():(this[R][0]=e.slice(t),e=e.slice(0,t),this[T]-=t),this.emit("data",e),!this[R].length&&!this[ht]&&this.emit("drain"),e}end(t,e,i){return typeof t=="function"&&(i=t,t=null),typeof e=="function"&&(i=e,e="utf8"),t&&this.write(t,e),i&&this.once("end",i),this[ht]=!0,this.writable=!1,(this.flowing||!this[Ee])&&this[ot](),this}[ee](){this[b]||(this[Ee]=!1,this[ke]=!0,this.emit("resume"),this[R].length?this[Ue]():this[ht]?this[ot]():this.emit("drain"))}resume(){return this[ee]()}pause(){this[ke]=!1,this[Ee]=!0}get destroyed(){return this[b]}get flowing(){return this[ke]}get paused(){return this[Ee]}[Ps](t){this[I]?this[T]+=1:this[T]+=t.length,this[R].push(t)}[Bs](){return this[I]?this[T]-=1:this[T]-=this[R][0].length,this[R].shift()}[Ue](t){do;while(this[fr](this[Bs]())&&this[R].length);!t&&!this[R].length&&!this[ht]&&this.emit("drain")}[fr](t){return this.emit("data",t),this.flowing}pipe(t,e){if(this[b])return;const i=this[bt];return e=e||{},t===lr.stdout||t===lr.stderr?e.end=!1:e.end=e.end!==!1,e.proxyErrors=!!e.proxyErrors,i?e.end&&t.end():(this[J].push(e.proxyErrors?new Gh(this,t,e):new _n(this,t,e)),this[at]?ye(()=>this[ee]()):this[ee]()),t}unpipe(t){const e=this[J].find(i=>i.dest===t);e&&(this[J].splice(this[J].indexOf(e),1),e.unpipe())}addListener(t,e){return this.on(t,e)}on(t,e){const i=super.on(t,e);return t==="data"&&!this[J].length&&!this.flowing?this[ee]():t==="readable"&&this[T]!==0?super.emit("readable"):Uh(t)&&this[bt]?(super.emit(t),this.removeAllListeners(t)):t==="error"&&this[pe]&&(this[at]?ye(()=>e.call(this,this[pe])):e.call(this,this[pe])),i}get emittedEnd(){return this[bt]}[ot](){!this[Fe]&&!this[bt]&&!this[b]&&this[R].length===0&&this[ht]&&(this[Fe]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[$e]&&this.emit("close"),this[Fe]=!1)}emit(t,e,...i){if(t!=="error"&&t!=="close"&&t!==b&&this[b])return;if(t==="data")return!this[I]&&!e?!1:this[at]?ye(()=>this[$s](e)):this[$s](e);if(t==="end")return this[dr]();if(t==="close"){if(this[$e]=!0,!this[bt]&&!this[b])return;const n=super.emit("close");return this.removeAllListeners("close"),n}else if(t==="error"){this[pe]=e,super.emit(Fs,e);const n=!this[$t]||this.listeners("error").length?super.emit("error",e):!1;return this[ot](),n}else if(t==="resume"){const n=super.emit("resume");return this[ot](),n}else if(t==="finish"||t==="prefinish"){const n=super.emit(t);return this.removeAllListeners(t),n}const r=super.emit(t,e,...i);return this[ot](),r}[$s](t){for(const i of this[J])i.dest.write(t)===!1&&this.pause();const e=super.emit("data",t);return this[ot](),e}[dr](){this[bt]||(this[bt]=!0,this.readable=!1,this[at]?ye(()=>this[Us]()):this[Us]())}[Us](){if(this[lt]){const e=this[lt].end();if(e){for(const i of this[J])i.dest.write(e);super.emit("data",e)}}for(const e of this[J])e.end();const t=super.emit("end");return this.removeAllListeners("end"),t}collect(){const t=[];this[I]||(t.dataLength=0);const e=this.promise();return this.on("data",i=>{t.push(i),this[I]||(t.dataLength+=i.length)}),e.then(()=>t)}concat(){return this[I]?Promise.reject(new Error("cannot concat in objectMode")):this.collect().then(t=>this[I]?Promise.reject(new Error("cannot concat in objectMode")):this[B]?t.join(""):Buffer.concat(t,t.dataLength))}promise(){return new Promise((t,e)=>{this.on(b,()=>e(new Error("stream destroyed"))),this.on("error",i=>e(i)),this.on("end",()=>t())})}[mr](){let t=!1;const e=()=>(this.pause(),t=!0,Promise.resolve({done:!0}));return{next:()=>{if(t)return e();const r=this.read();if(r!==null)return Promise.resolve({done:!1,value:r});if(this[ht])return e();let n=null,h=null;const o=u=>{this.removeListener("data",a),this.removeListener("end",l),this.removeListener(b,c),e(),h(u)},a=u=>{this.removeListener("error",o),this.removeListener("end",l),this.removeListener(b,c),this.pause(),n({value:u,done:!!this[ht]})},l=()=>{this.removeListener("error",o),this.removeListener("data",a),this.removeListener(b,c),e(),n({done:!0})},c=()=>o(new Error("stream destroyed"));return new Promise((u,f)=>{h=f,n=u,this.once(b,c),this.once("error",o),this.once("end",l),this.once("data",a)})},throw:e,return:e,[mr](){return this}}}[pr](){let t=!1;const e=()=>(this.pause(),this.removeListener(Fs,e),this.removeListener(b,e),this.removeListener("end",e),t=!0,{done:!0}),i=()=>{if(t)return e();const r=this.read();return r===null?e():{value:r}};return this.once("end",e),this.once(Fs,e),this.once(b,e),{next:i,throw:e,return:e,[pr](){return this}}}destroy(t){return this[b]?(t?this.emit("error",t):this.emit(b),this):(this[b]=!0,this[R].length=0,this[T]=0,typeof this.close=="function"&&!this[$e]&&this.close(),t?this.emit("error",t):this.emit(b),this)}static isStream(t){return!!t&&(t instanceof On||t instanceof ar||t instanceof Fh&&(typeof t.pipe=="function"||typeof t.write=="function"&&typeof t.end=="function"))}};vs.Minipass=Hh;var k={};const Yh=Rn.constants||{ZLIB_VERNUM:4736};var Wh=Object.freeze(Object.assign(Object.create(null),{Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_VERSION_ERROR:-6,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,DEFLATE:1,INFLATE:2,GZIP:3,GUNZIP:4,DEFLATERAW:5,INFLATERAW:6,UNZIP:7,BROTLI_DECODE:8,BROTLI_ENCODE:9,Z_MIN_WINDOWBITS:8,Z_MAX_WINDOWBITS:15,Z_DEFAULT_WINDOWBITS:15,Z_MIN_CHUNK:64,Z_MAX_CHUNK:1/0,Z_DEFAULT_CHUNK:16384,Z_MIN_MEMLEVEL:1,Z_MAX_MEMLEVEL:9,Z_DEFAULT_MEMLEVEL:8,Z_MIN_LEVEL:-1,Z_MAX_LEVEL:9,Z_DEFAULT_LEVEL:-1,BROTLI_OPERATION_PROCESS:0,BROTLI_OPERATION_FLUSH:1,BROTLI_OPERATION_FINISH:2,BROTLI_OPERATION_EMIT_METADATA:3,BROTLI_MODE_GENERIC:0,BROTLI_MODE_TEXT:1,BROTLI_MODE_FONT:2,BROTLI_DEFAULT_MODE:0,BROTLI_MIN_QUALITY:0,BROTLI_MAX_QUALITY:11,BROTLI_DEFAULT_QUALITY:11,BROTLI_MIN_WINDOW_BITS:10,BROTLI_MAX_WINDOW_BITS:24,BROTLI_LARGE_MAX_WINDOW_BITS:30,BROTLI_DEFAULT_WINDOW:22,BROTLI_MIN_INPUT_BLOCK_BITS:16,BROTLI_MAX_INPUT_BLOCK_BITS:24,BROTLI_PARAM_MODE:0,BROTLI_PARAM_QUALITY:1,BROTLI_PARAM_LGWIN:2,BROTLI_PARAM_LGBLOCK:3,BROTLI_PARAM_DISABLE_LITERAL_CONTEXT_MODELING:4,BROTLI_PARAM_SIZE_HINT:5,BROTLI_PARAM_LARGE_WINDOW:6,BROTLI_PARAM_NPOSTFIX:7,BROTLI_PARAM_NDIRECT:8,BROTLI_DECODER_RESULT_ERROR:0,BROTLI_DECODER_RESULT_SUCCESS:1,BROTLI_DECODER_RESULT_NEEDS_MORE_INPUT:2,BROTLI_DECODER_RESULT_NEEDS_MORE_OUTPUT:3,BROTLI_DECODER_PARAM_DISABLE_RING_BUFFER_REALLOCATION:0,BROTLI_DECODER_PARAM_LARGE_WINDOW:1,BROTLI_DECODER_NO_ERROR:0,BROTLI_DECODER_SUCCESS:1,BROTLI_DECODER_NEEDS_MORE_INPUT:2,BROTLI_DECODER_NEEDS_MORE_OUTPUT:3,BROTLI_DECODER_ERROR_FORMAT_EXUBERANT_NIBBLE:-1,BROTLI_DECODER_ERROR_FORMAT_RESERVED:-2,BROTLI_DECODER_ERROR_FORMAT_EXUBERANT_META_NIBBLE:-3,BROTLI_DECODER_ERROR_FORMAT_SIMPLE_HUFFMAN_ALPHABET:-4,BROTLI_DECODER_ERROR_FORMAT_SIMPLE_HUFFMAN_SAME:-5,BROTLI_DECODER_ERROR_FORMAT_CL_SPACE:-6,BROTLI_DECODER_ERROR_FORMAT_HUFFMAN_SPACE:-7,BROTLI_DECODER_ERROR_FORMAT_CONTEXT_MAP_REPEAT:-8,BROTLI_DECODER_ERROR_FORMAT_BLOCK_LENGTH_1:-9,BROTLI_DECODER_ERROR_FORMAT_BLOCK_LENGTH_2:-10,BROTLI_DECODER_ERROR_FORMAT_TRANSFORM:-11,BROTLI_DECODER_ERROR_FORMAT_DICTIONARY:-12,BROTLI_DECODER_ERROR_FORMAT_WINDOW_BITS:-13,BROTLI_DECODER_ERROR_FORMAT_PADDING_1:-14,BROTLI_DECODER_ERROR_FORMAT_PADDING_2:-15,BROTLI_DECODER_ERROR_FORMAT_DISTANCE:-16,BROTLI_DECODER_ERROR_DICTIONARY_NOT_SET:-19,BROTLI_DECODER_ERROR_INVALID_ARGUMENTS:-20,BROTLI_DECODER_ERROR_ALLOC_CONTEXT_MODES:-21,BROTLI_DECODER_ERROR_ALLOC_TREE_GROUPS:-22,BROTLI_DECODER_ERROR_ALLOC_CONTEXT_MAP:-25,BROTLI_DECODER_ERROR_ALLOC_RING_BUFFER_1:-26,BROTLI_DECODER_ERROR_ALLOC_RING_BUFFER_2:-27,BROTLI_DECODER_ERROR_ALLOC_BLOCK_TYPE_TREES:-30,BROTLI_DECODER_ERROR_UNREACHABLE:-31},Yh));const Er=typeof process=="object"&&process?process:{stdout:null,stderr:null},Zh=Pe,yr=ji,wr=qi.StringDecoder,ct=Symbol("EOF"),ut=Symbol("maybeEmitEnd"),_t=Symbol("emittedEnd"),Ge=Symbol("emittingEnd"),we=Symbol("emittedError"),He=Symbol("closed"),Sr=Symbol("read"),Ye=Symbol("flush"),gr=Symbol("flushChunk"),F=Symbol("encoding"),ft=Symbol("decoder"),We=Symbol("flowing"),Se=Symbol("paused"),se=Symbol("resume"),L=Symbol("bufferLength"),zs=Symbol("bufferPush"),Gs=Symbol("bufferShift"),A=Symbol("objectMode"),M=Symbol("destroyed"),Hs=Symbol("emitData"),Rr=Symbol("emitEnd"),Ys=Symbol("emitEnd2"),dt=Symbol("async"),ge=s=>Promise.resolve().then(s),Tn=Is._MP_NO_ITERATOR_SYMBOLS_!=="1",jh=Tn&&Symbol.asyncIterator||Symbol("asyncIterator not implemented"),qh=Tn&&Symbol.iterator||Symbol("iterator not implemented"),Kh=s=>s==="end"||s==="finish"||s==="prefinish",Vh=s=>s instanceof ArrayBuffer||typeof s=="object"&&s.constructor&&s.constructor.name==="ArrayBuffer"&&s.byteLength>=0,Xh=s=>!Buffer.isBuffer(s)&&ArrayBuffer.isView(s);let Ln=class{constructor(t,e,i){this.src=t,this.dest=e,this.opts=i,this.ondrain=()=>t[se](),e.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(){}end(){this.unpipe(),this.opts.end&&this.dest.end()}},Jh=class extends Ln{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(t,e,i){super(t,e,i),this.proxyErrors=r=>e.emit("error",r),t.on("error",this.proxyErrors)}};var Qh=class Dn extends yr{constructor(t){super(),this[We]=!1,this[Se]=!1,this.pipes=[],this.buffer=[],this[A]=t&&t.objectMode||!1,this[A]?this[F]=null:this[F]=t&&t.encoding||null,this[F]==="buffer"&&(this[F]=null),this[dt]=t&&!!t.async||!1,this[ft]=this[F]?new wr(this[F]):null,this[ct]=!1,this[_t]=!1,this[Ge]=!1,this[He]=!1,this[we]=null,this.writable=!0,this.readable=!0,this[L]=0,this[M]=!1}get bufferLength(){return this[L]}get encoding(){return this[F]}set encoding(t){if(this[A])throw new Error("cannot set encoding in objectMode");if(this[F]&&t!==this[F]&&(this[ft]&&this[ft].lastNeed||this[L]))throw new Error("cannot change encoding");this[F]!==t&&(this[ft]=t?new wr(t):null,this.buffer.length&&(this.buffer=this.buffer.map(e=>this[ft].write(e)))),this[F]=t}setEncoding(t){this.encoding=t}get objectMode(){return this[A]}set objectMode(t){this[A]=this[A]||!!t}get async(){return this[dt]}set async(t){this[dt]=this[dt]||!!t}write(t,e,i){if(this[ct])throw new Error("write after end");if(this[M])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;typeof e=="function"&&(i=e,e="utf8"),e||(e="utf8");const r=this[dt]?ge:n=>n();return!this[A]&&!Buffer.isBuffer(t)&&(Xh(t)?t=Buffer.from(t.buffer,t.byteOffset,t.byteLength):Vh(t)?t=Buffer.from(t):typeof t!="string"&&(this.objectMode=!0)),this[A]?(this.flowing&&this[L]!==0&&this[Ye](!0),this.flowing?this.emit("data",t):this[zs](t),this[L]!==0&&this.emit("readable"),i&&r(i),this.flowing):t.length?(typeof t=="string"&&!(e===this[F]&&!this[ft].lastNeed)&&(t=Buffer.from(t,e)),Buffer.isBuffer(t)&&this[F]&&(t=this[ft].write(t)),this.flowing&&this[L]!==0&&this[Ye](!0),this.flowing?this.emit("data",t):this[zs](t),this[L]!==0&&this.emit("readable"),i&&r(i),this.flowing):(this[L]!==0&&this.emit("readable"),i&&r(i),this.flowing)}read(t){if(this[M])return null;if(this[L]===0||t===0||t>this[L])return this[ut](),null;this[A]&&(t=null),this.buffer.length>1&&!this[A]&&(this.encoding?this.buffer=[this.buffer.join("")]:this.buffer=[Buffer.concat(this.buffer,this[L])]);const e=this[Sr](t||null,this.buffer[0]);return this[ut](),e}[Sr](t,e){return t===e.length||t===null?this[Gs]():(this.buffer[0]=e.slice(t),e=e.slice(0,t),this[L]-=t),this.emit("data",e),!this.buffer.length&&!this[ct]&&this.emit("drain"),e}end(t,e,i){return typeof t=="function"&&(i=t,t=null),typeof e=="function"&&(i=e,e="utf8"),t&&this.write(t,e),i&&this.once("end",i),this[ct]=!0,this.writable=!1,(this.flowing||!this[Se])&&this[ut](),this}[se](){this[M]||(this[Se]=!1,this[We]=!0,this.emit("resume"),this.buffer.length?this[Ye]():this[ct]?this[ut]():this.emit("drain"))}resume(){return this[se]()}pause(){this[We]=!1,this[Se]=!0}get destroyed(){return this[M]}get flowing(){return this[We]}get paused(){return this[Se]}[zs](t){this[A]?this[L]+=1:this[L]+=t.length,this.buffer.push(t)}[Gs](){return this.buffer.length&&(this[A]?this[L]-=1:this[L]-=this.buffer[0].length),this.buffer.shift()}[Ye](t){do;while(this[gr](this[Gs]()));!t&&!this.buffer.length&&!this[ct]&&this.emit("drain")}[gr](t){return t?(this.emit("data",t),this.flowing):!1}pipe(t,e){if(this[M])return;const i=this[_t];return e=e||{},t===Er.stdout||t===Er.stderr?e.end=!1:e.end=e.end!==!1,e.proxyErrors=!!e.proxyErrors,i?e.end&&t.end():(this.pipes.push(e.proxyErrors?new Jh(this,t,e):new Ln(this,t,e)),this[dt]?ge(()=>this[se]()):this[se]()),t}unpipe(t){const e=this.pipes.find(i=>i.dest===t);e&&(this.pipes.splice(this.pipes.indexOf(e),1),e.unpipe())}addListener(t,e){return this.on(t,e)}on(t,e){const i=super.on(t,e);return t==="data"&&!this.pipes.length&&!this.flowing?this[se]():t==="readable"&&this[L]!==0?super.emit("readable"):Kh(t)&&this[_t]?(super.emit(t),this.removeAllListeners(t)):t==="error"&&this[we]&&(this[dt]?ge(()=>e.call(this,this[we])):e.call(this,this[we])),i}get emittedEnd(){return this[_t]}[ut](){!this[Ge]&&!this[_t]&&!this[M]&&this.buffer.length===0&&this[ct]&&(this[Ge]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[He]&&this.emit("close"),this[Ge]=!1)}emit(t,e,...i){if(t!=="error"&&t!=="close"&&t!==M&&this[M])return;if(t==="data")return e?this[dt]?ge(()=>this[Hs](e)):this[Hs](e):!1;if(t==="end")return this[Rr]();if(t==="close"){if(this[He]=!0,!this[_t]&&!this[M])return;const n=super.emit("close");return this.removeAllListeners("close"),n}else if(t==="error"){this[we]=e;const n=super.emit("error",e);return this[ut](),n}else if(t==="resume"){const n=super.emit("resume");return this[ut](),n}else if(t==="finish"||t==="prefinish"){const n=super.emit(t);return this.removeAllListeners(t),n}const r=super.emit(t,e,...i);return this[ut](),r}[Hs](t){for(const i of this.pipes)i.dest.write(t)===!1&&this.pause();const e=super.emit("data",t);return this[ut](),e}[Rr](){this[_t]||(this[_t]=!0,this.readable=!1,this[dt]?ge(()=>this[Ys]()):this[Ys]())}[Ys](){if(this[ft]){const e=this[ft].end();if(e){for(const i of this.pipes)i.dest.write(e);super.emit("data",e)}}for(const e of this.pipes)e.end();const t=super.emit("end");return this.removeAllListeners("end"),t}collect(){const t=[];this[A]||(t.dataLength=0);const e=this.promise();return this.on("data",i=>{t.push(i),this[A]||(t.dataLength+=i.length)}),e.then(()=>t)}concat(){return this[A]?Promise.reject(new Error("cannot concat in objectMode")):this.collect().then(t=>this[A]?Promise.reject(new Error("cannot concat in objectMode")):this[F]?t.join(""):Buffer.concat(t,t.dataLength))}promise(){return new Promise((t,e)=>{this.on(M,()=>e(new Error("stream destroyed"))),this.on("error",i=>e(i)),this.on("end",()=>t())})}[jh](){return{next:()=>{const e=this.read();if(e!==null)return Promise.resolve({done:!1,value:e});if(this[ct])return Promise.resolve({done:!0});let i=null,r=null;const n=l=>{this.removeListener("data",h),this.removeListener("end",o),r(l)},h=l=>{this.removeListener("error",n),this.removeListener("end",o),this.pause(),i({value:l,done:!!this[ct]})},o=()=>{this.removeListener("error",n),this.removeListener("data",h),i({done:!0})},a=()=>n(new Error("stream destroyed"));return new Promise((l,c)=>{r=c,i=l,this.once(M,a),this.once("error",n),this.once("end",o),this.once("data",h)})}}}[qh](){return{next:()=>{const e=this.read();return{value:e,done:e===null}}}}destroy(t){return this[M]?(t?this.emit("error",t):this.emit(M),this):(this[M]=!0,this.buffer.length=0,this[L]=0,typeof this.close=="function"&&!this[He]&&this.close(),t?this.emit("error",t):this.emit(M),this)}static isStream(t){return!!t&&(t instanceof Dn||t instanceof yr||t instanceof Zh&&(typeof t.pipe=="function"||typeof t.write=="function"&&typeof t.end=="function"))}};const Oi=Ki,It=vh.Buffer,Nn=Rn,Zt=k.constants=Wh,to=Qh,br=It.concat,jt=Symbol("_superWrite");class Ze extends Error{constructor(t){super("zlib: "+t.message),this.code=t.code,this.errno=t.errno,this.code||(this.code="ZLIB_ERROR"),this.message="zlib: "+t.message,Error.captureStackTrace(this,this.constructor)}get name(){return"ZlibError"}}const eo=Symbol("opts"),Re=Symbol("flushFlag"),_r=Symbol("finishFlushFlag"),Vi=Symbol("fullFlushFlag"),S=Symbol("handle"),je=Symbol("onError"),ie=Symbol("sawError"),Ws=Symbol("level"),Zs=Symbol("strategy"),js=Symbol("ended");class In extends to{constructor(t,e){if(!t||typeof t!="object")throw new TypeError("invalid options for ZlibBase constructor");super(t),this[ie]=!1,this[js]=!1,this[eo]=t,this[Re]=t.flush,this[_r]=t.finishFlush;try{this[S]=new Nn[e](t)}catch(i){throw new Ze(i)}this[je]=i=>{this[ie]||(this[ie]=!0,this.close(),this.emit("error",i))},this[S].on("error",i=>this[je](new Ze(i))),this.once("end",()=>this.close)}close(){this[S]&&(this[S].close(),this[S]=null,this.emit("close"))}reset(){if(!this[ie])return Oi(this[S],"zlib binding closed"),this[S].reset()}flush(t){this.ended||(typeof t!="number"&&(t=this[Vi]),this.write(Object.assign(It.alloc(0),{[Re]:t})))}end(t,e,i){return t&&this.write(t,e),this.flush(this[_r]),this[js]=!0,super.end(null,null,i)}get ended(){return this[js]}write(t,e,i){if(typeof e=="function"&&(i=e,e="utf8"),typeof t=="string"&&(t=It.from(t,e)),this[ie])return;Oi(this[S],"zlib binding closed");const r=this[S]._handle,n=r.close;r.close=()=>{};const h=this[S].close;this[S].close=()=>{},It.concat=l=>l;let o;try{const l=typeof t[Re]=="number"?t[Re]:this[Re];o=this[S]._processChunk(t,l),It.concat=br}catch(l){It.concat=br,this[je](new Ze(l))}finally{this[S]&&(this[S]._handle=r,r.close=n,this[S].close=h,this[S].removeAllListeners("error"))}this[S]&&this[S].on("error",l=>this[je](new Ze(l)));let a;if(o)if(Array.isArray(o)&&o.length>0){a=this[jt](It.from(o[0]));for(let l=1;l<o.length;l++)a=this[jt](o[l])}else a=this[jt](It.from(o));return i&&i(),a}[jt](t){return super.write(t)}}class Vt extends In{constructor(t,e){t=t||{},t.flush=t.flush||Zt.Z_NO_FLUSH,t.finishFlush=t.finishFlush||Zt.Z_FINISH,super(t,e),this[Vi]=Zt.Z_FULL_FLUSH,this[Ws]=t.level,this[Zs]=t.strategy}params(t,e){if(!this[ie]){if(!this[S])throw new Error("cannot switch params when binding is closed");if(!this[S].params)throw new Error("not supported in this implementation");if(this[Ws]!==t||this[Zs]!==e){this.flush(Zt.Z_SYNC_FLUSH),Oi(this[S],"zlib binding closed");const i=this[S].flush;this[S].flush=(r,n)=>{this.flush(r),n()};try{this[S].params(t,e)}finally{this[S].flush=i}this[S]&&(this[Ws]=t,this[Zs]=e)}}}}class so extends Vt{constructor(t){super(t,"Deflate")}}class io extends Vt{constructor(t){super(t,"Inflate")}}const qs=Symbol("_portable");class ro extends Vt{constructor(t){super(t,"Gzip"),this[qs]=t&&!!t.portable}[jt](t){return this[qs]?(this[qs]=!1,t[9]=255,super[jt](t)):super[jt](t)}}class no extends Vt{constructor(t){super(t,"Gunzip")}}class ho extends Vt{constructor(t){super(t,"DeflateRaw")}}class oo extends Vt{constructor(t){super(t,"InflateRaw")}}class lo extends Vt{constructor(t){super(t,"Unzip")}}class vn extends In{constructor(t,e){t=t||{},t.flush=t.flush||Zt.BROTLI_OPERATION_PROCESS,t.finishFlush=t.finishFlush||Zt.BROTLI_OPERATION_FINISH,super(t,e),this[Vi]=Zt.BROTLI_OPERATION_FLUSH}}class ao extends vn{constructor(t){super(t,"BrotliCompress")}}class co extends vn{constructor(t){super(t,"BrotliDecompress")}}k.Deflate=so;k.Inflate=io;k.Gzip=ro;k.Gunzip=no;k.DeflateRaw=ho;k.InflateRaw=oo;k.Unzip=lo;typeof Nn.BrotliCompress=="function"?(k.BrotliCompress=ao,k.BrotliDecompress=co):k.BrotliCompress=k.BrotliDecompress=class{constructor(){throw new Error("Brotli is not supported in this version of Node.js")}};const uo=process.env.TESTING_TAR_FAKE_PLATFORM||process.platform;var Be=uo!=="win32"?s=>s:s=>s&&s.replace(/\\/g,"/");const{Minipass:fo}=vs,Ks=Be,Vs=Symbol("slurp");var An=class extends fo{constructor(t,e,i){switch(super(),this.pause(),this.extended=e,this.globalExtended=i,this.header=t,this.startBlockSize=512*Math.ceil(t.size/512),this.blockRemain=this.startBlockSize,this.remain=t.size,this.type=t.type,this.meta=!1,this.ignore=!1,this.type){case"File":case"OldFile":case"Link":case"SymbolicLink":case"CharacterDevice":case"BlockDevice":case"Directory":case"FIFO":case"ContiguousFile":case"GNUDumpDir":break;case"NextFileHasLongLinkpath":case"NextFileHasLongPath":case"OldGnuLongPath":case"GlobalExtendedHeader":case"ExtendedHeader":case"OldExtendedHeader":this.meta=!0;break;default:this.ignore=!0}this.path=Ks(t.path),this.mode=t.mode,this.mode&&(this.mode=this.mode&4095),this.uid=t.uid,this.gid=t.gid,this.uname=t.uname,this.gname=t.gname,this.size=t.size,this.mtime=t.mtime,this.atime=t.atime,this.ctime=t.ctime,this.linkpath=Ks(t.linkpath),this.uname=t.uname,this.gname=t.gname,e&&this[Vs](e),i&&this[Vs](i,!0)}write(t){const e=t.length;if(e>this.blockRemain)throw new Error("writing more to entry than is appropriate");const i=this.remain,r=this.blockRemain;return this.remain=Math.max(0,i-e),this.blockRemain=Math.max(0,r-e),this.ignore?!0:i>=e?super.write(t):super.write(t.slice(0,i))}[Vs](t,e){for(const i in t)t[i]!==null&&t[i]!==void 0&&!(e&&i==="path")&&(this[i]=i==="path"||i==="linkpath"?Ks(t[i]):t[i])}},Mn={};(function(s){s.name=new Map([["0","File"],["","OldFile"],["1","Link"],["2","SymbolicLink"],["3","CharacterDevice"],["4","BlockDevice"],["5","Directory"],["6","FIFO"],["7","ContiguousFile"],["g","GlobalExtendedHeader"],["x","ExtendedHeader"],["A","SolarisACL"],["D","GNUDumpDir"],["I","Inode"],["K","NextFileHasLongLinkpath"],["L","NextFileHasLongPath"],["M","ContinuationFile"],["N","OldGnuLongPath"],["S","SparseFile"],["V","TapeVolumeHeader"],["X","OldExtendedHeader"]]),s.code=new Map(Array.from(s.name).map(t=>[t[1],t[0]]))})(Mn);const mo=(s,t)=>{if(Number.isSafeInteger(s))s<0?Eo(s,t):po(s,t);else throw Error("cannot encode number outside of javascript safe integer range");return t},po=(s,t)=>{t[0]=128;for(var e=t.length;e>1;e--)t[e-1]=s&255,s=Math.floor(s/256)},Eo=(s,t)=>{t[0]=255;var e=!1;s=s*-1;for(var i=t.length;i>1;i--){var r=s&255;s=Math.floor(s/256),e?t[i-1]=Cn(r):r===0?t[i-1]=0:(e=!0,t[i-1]=xn(r))}},yo=s=>{const t=s[0],e=t===128?So(s.slice(1,s.length)):t===255?wo(s):null;if(e===null)throw Error("invalid base256 encoding");if(!Number.isSafeInteger(e))throw Error("parsed number outside of javascript safe integer range");return e},wo=s=>{for(var t=s.length,e=0,i=!1,r=t-1;r>-1;r--){var n=s[r],h;i?h=Cn(n):n===0?h=n:(i=!0,h=xn(n)),h!==0&&(e-=h*Math.pow(256,t-r-1))}return e},So=s=>{for(var t=s.length,e=0,i=t-1;i>-1;i--){var r=s[i];r!==0&&(e+=r*Math.pow(256,t-i-1))}return e},Cn=s=>(255^s)&255,xn=s=>(255^s)+1&255;var go={encode:mo,parse:yo};const Xs=Mn,Xt=y.posix,Pn=go,Js=Symbol("slurp"),G=Symbol("type");let Ro=class{constructor(t,e,i,r){this.cksumValid=!1,this.needPax=!1,this.nullBlock=!1,this.block=null,this.path=null,this.mode=null,this.uid=null,this.gid=null,this.size=null,this.mtime=null,this.cksum=null,this[G]="0",this.linkpath=null,this.uname=null,this.gname=null,this.devmaj=0,this.devmin=0,this.atime=null,this.ctime=null,Buffer.isBuffer(t)?this.decode(t,e||0,i,r):t&&this.set(t)}decode(t,e,i,r){if(e||(e=0),!t||!(t.length>=e+512))throw new Error("need 512 bytes for header");if(this.path=Ut(t,e,100),this.mode=vt(t,e+100,8),this.uid=vt(t,e+108,8),this.gid=vt(t,e+116,8),this.size=vt(t,e+124,12),this.mtime=Qs(t,e+136,12),this.cksum=vt(t,e+148,12),this[Js](i),this[Js](r,!0),this[G]=Ut(t,e+156,1),this[G]===""&&(this[G]="0"),this[G]==="0"&&this.path.slice(-1)==="/"&&(this[G]="5"),this[G]==="5"&&(this.size=0),this.linkpath=Ut(t,e+157,100),t.slice(e+257,e+265).toString()==="ustar\x0000")if(this.uname=Ut(t,e+265,32),this.gname=Ut(t,e+297,32),this.devmaj=vt(t,e+329,8),this.devmin=vt(t,e+337,8),t[e+475]!==0){const h=Ut(t,e+345,155);this.path=h+"/"+this.path}else{const h=Ut(t,e+345,130);h&&(this.path=h+"/"+this.path),this.atime=Qs(t,e+476,12),this.ctime=Qs(t,e+488,12)}let n=8*32;for(let h=e;h<e+148;h++)n+=t[h];for(let h=e+156;h<e+512;h++)n+=t[h];this.cksumValid=n===this.cksum,this.cksum===null&&n===8*32&&(this.nullBlock=!0)}[Js](t,e){for(const i in t)t[i]!==null&&t[i]!==void 0&&!(e&&i==="path")&&(this[i]=t[i])}encode(t,e){if(t||(t=this.block=Buffer.alloc(512),e=0),e||(e=0),!(t.length>=e+512))throw new Error("need 512 bytes for header");const i=this.ctime||this.atime?130:155,r=bo(this.path||"",i),n=r[0],h=r[1];this.needPax=r[2],this.needPax=kt(t,e,100,n)||this.needPax,this.needPax=At(t,e+100,8,this.mode)||this.needPax,this.needPax=At(t,e+108,8,this.uid)||this.needPax,this.needPax=At(t,e+116,8,this.gid)||this.needPax,this.needPax=At(t,e+124,12,this.size)||this.needPax,this.needPax=ti(t,e+136,12,this.mtime)||this.needPax,t[e+156]=this[G].charCodeAt(0),this.needPax=kt(t,e+157,100,this.linkpath)||this.needPax,t.write("ustar\x0000",e+257,8),this.needPax=kt(t,e+265,32,this.uname)||this.needPax,this.needPax=kt(t,e+297,32,this.gname)||this.needPax,this.needPax=At(t,e+329,8,this.devmaj)||this.needPax,this.needPax=At(t,e+337,8,this.devmin)||this.needPax,this.needPax=kt(t,e+345,i,h)||this.needPax,t[e+475]!==0?this.needPax=kt(t,e+345,155,h)||this.needPax:(this.needPax=kt(t,e+345,130,h)||this.needPax,this.needPax=ti(t,e+476,12,this.atime)||this.needPax,this.needPax=ti(t,e+488,12,this.ctime)||this.needPax);let o=8*32;for(let a=e;a<e+148;a++)o+=t[a];for(let a=e+156;a<e+512;a++)o+=t[a];return this.cksum=o,At(t,e+148,8,this.cksum),this.cksumValid=!0,this.needPax}set(t){for(const e in t)t[e]!==null&&t[e]!==void 0&&(this[e]=t[e])}get type(){return Xs.name.get(this[G])||this[G]}get typeKey(){return this[G]}set type(t){Xs.code.has(t)?this[G]=Xs.code.get(t):this[G]=t}};const bo=(s,t)=>{let i=s,r="",n;const h=Xt.parse(s).root||".";if(Buffer.byteLength(i)<100)n=[i,r,!1];else{r=Xt.dirname(i),i=Xt.basename(i);do Buffer.byteLength(i)<=100&&Buffer.byteLength(r)<=t?n=[i,r,!1]:Buffer.byteLength(i)>100&&Buffer.byteLength(r)<=t?n=[i.slice(0,99),r,!0]:(i=Xt.join(Xt.basename(r),i),r=Xt.dirname(r));while(r!==h&&!n);n||(n=[s.slice(0,99),"",!0])}return n},Ut=(s,t,e)=>s.slice(t,t+e).toString("utf8").replace(/\0.*/,""),Qs=(s,t,e)=>_o(vt(s,t,e)),_o=s=>s===null?null:new Date(s*1e3),vt=(s,t,e)=>s[t]&128?Pn.parse(s.slice(t,t+e)):To(s,t,e),Oo=s=>isNaN(s)?null:s,To=(s,t,e)=>Oo(parseInt(s.slice(t,t+e).toString("utf8").replace(/\0.*$/,"").trim(),8)),Lo={12:8589934591,8:2097151},At=(s,t,e,i)=>i===null?!1:i>Lo[e]||i<0?(Pn.encode(i,s.slice(t,t+e)),!0):(Do(s,t,e,i),!1),Do=(s,t,e,i)=>s.write(No(i,e),t,e,"ascii"),No=(s,t)=>Io(Math.floor(s).toString(8),t),Io=(s,t)=>(s.length===t-1?s:new Array(t-s.length-1).join("0")+s+" ")+"\0",ti=(s,t,e,i)=>i===null?!1:At(s,t,e,i.getTime()/1e3),vo=new Array(156).join("\0"),kt=(s,t,e,i)=>i===null?!1:(s.write(i+vo,t,e,"utf8"),i.length!==Buffer.byteLength(i)||i.length>e);var Xi=Ro;const Ao=Xi,Mo=y;let Ti=class{constructor(t,e){this.atime=t.atime||null,this.charset=t.charset||null,this.comment=t.comment||null,this.ctime=t.ctime||null,this.gid=t.gid||null,this.gname=t.gname||null,this.linkpath=t.linkpath||null,this.mtime=t.mtime||null,this.path=t.path||null,this.size=t.size||null,this.uid=t.uid||null,this.uname=t.uname||null,this.dev=t.dev||null,this.ino=t.ino||null,this.nlink=t.nlink||null,this.global=e||!1}encode(){const t=this.encodeBody();if(t==="")return null;const e=Buffer.byteLength(t),i=512*Math.ceil(1+e/512),r=Buffer.allocUnsafe(i);for(let n=0;n<512;n++)r[n]=0;new Ao({path:("PaxHeader/"+Mo.basename(this.path)).slice(0,99),mode:this.mode||420,uid:this.uid||null,gid:this.gid||null,size:e,mtime:this.mtime||null,type:this.global?"GlobalExtendedHeader":"ExtendedHeader",linkpath:"",uname:this.uname||"",gname:this.gname||"",devmaj:0,devmin:0,atime:this.atime||null,ctime:this.ctime||null}).encode(r),r.write(t,512,e,"utf8");for(let n=e+512;n<r.length;n++)r[n]=0;return r}encodeBody(){return this.encodeField("path")+this.encodeField("ctime")+this.encodeField("atime")+this.encodeField("dev")+this.encodeField("ino")+this.encodeField("nlink")+this.encodeField("charset")+this.encodeField("comment")+this.encodeField("gid")+this.encodeField("gname")+this.encodeField("linkpath")+this.encodeField("mtime")+this.encodeField("size")+this.encodeField("uid")+this.encodeField("uname")}encodeField(t){if(this[t]===null||this[t]===void 0)return"";const e=this[t]instanceof Date?this[t].getTime()/1e3:this[t],i=" "+(t==="dev"||t==="ino"||t==="nlink"?"SCHILY.":"")+t+"="+e+`
`,r=Buffer.byteLength(i);let n=Math.floor(Math.log(r)/Math.log(10))+1;return r+n>=Math.pow(10,n)&&(n+=1),n+r+i}};Ti.parse=(s,t,e)=>new Ti(Co(xo(s),t),e);const Co=(s,t)=>t?Object.keys(s).reduce((e,i)=>(e[i]=s[i],e),t):s,xo=s=>s.replace(/\n$/,"").split(`
`).reduce(Po,Object.create(null)),Po=(s,t)=>{const e=parseInt(t,10);if(e!==Buffer.byteLength(t)+1)return s;t=t.slice((e+" ").length);const i=t.split("="),r=i.shift().replace(/^SCHILY\.(dev|ino|nlink)/,"$1");if(!r)return s;const n=i.join("=");return s[r]=/^([A-Z]+\.)?([mac]|birth|creation)time$/.test(r)?new Date(n*1e3):/^[0-9]+$/.test(n)?+n:n,s};var Bn=Ti,As=s=>{let t=s.length-1,e=-1;for(;t>-1&&s.charAt(t)==="/";)e=t,t--;return e===-1?s:s.slice(0,e)},Ji=s=>class extends s{warn(t,e,i={}){this.file&&(i.file=this.file),this.cwd&&(i.cwd=this.cwd),i.code=e instanceof Error&&e.code||t,i.tarCode=t,!this.strict&&i.recoverable!==!1?(e instanceof Error&&(i=Object.assign(e,i),e=e.message),this.emit("warn",i.tarCode,e,i)):e instanceof Error?this.emit("error",Object.assign(e,i)):this.emit("error",Object.assign(new Error(`${t}: ${e}`),i))}};const Ms=["|","<",">","?",":"],Qi=Ms.map(s=>String.fromCharCode(61440+s.charCodeAt(0))),Bo=new Map(Ms.map((s,t)=>[s,Qi[t]])),Fo=new Map(Qi.map((s,t)=>[s,Ms[t]]));var Fn={encode:s=>Ms.reduce((t,e)=>t.split(e).join(Bo.get(e)),s),decode:s=>Qi.reduce((t,e)=>t.split(e).join(Fo.get(e)),s)};const{isAbsolute:$o,parse:Or}=y.win32;var $n=s=>{let t="",e=Or(s);for(;$o(s)||e.root;){const i=s.charAt(0)==="/"&&s.slice(0,4)!=="//?/"?"/":e.root;s=s.slice(i.length),t+=i,e=Or(s)}return[t,s]},ei,Tr;function Uo(){return Tr||(Tr=1,ei=(s,t,e)=>(s&=4095,e&&(s=(s|384)&-19),t&&(s&256&&(s|=64),s&32&&(s|=8),s&4&&(s|=1)),s)),ei}const{Minipass:Un}=vs,kn=Bn,zn=Xi,it=v,Lr=y,st=Be,ko=As,Gn=(s,t)=>t?(s=st(s).replace(/^\.(\/|$)/,""),ko(t)+"/"+s):st(s),zo=16*1024*1024,Dr=Symbol("process"),Nr=Symbol("file"),Ir=Symbol("directory"),Li=Symbol("symlink"),vr=Symbol("hardlink"),be=Symbol("header"),us=Symbol("read"),Di=Symbol("lstat"),fs=Symbol("onlstat"),Ni=Symbol("onread"),Ii=Symbol("onreadlink"),vi=Symbol("openfile"),Ai=Symbol("onopenfile"),Mt=Symbol("close"),Rs=Symbol("mode"),Mi=Symbol("awaitDrain"),si=Symbol("ondrain"),rt=Symbol("prefix"),Ar=Symbol("hadError"),Hn=Ji,Go=Fn,Yn=$n,Wn=Uo(),Cs=Hn(class extends Un{constructor(t,e){if(e=e||{},super(e),typeof t!="string")throw new TypeError("path is required");this.path=st(t),this.portable=!!e.portable,this.myuid=process.getuid&&process.getuid()||0,this.myuser=process.env.USER||"",this.maxReadSize=e.maxReadSize||zo,this.linkCache=e.linkCache||new Map,this.statCache=e.statCache||new Map,this.preservePaths=!!e.preservePaths,this.cwd=st(e.cwd||process.cwd()),this.strict=!!e.strict,this.noPax=!!e.noPax,this.noMtime=!!e.noMtime,this.mtime=e.mtime||null,this.prefix=e.prefix?st(e.prefix):null,this.fd=null,this.blockLen=null,this.blockRemain=null,this.buf=null,this.offset=null,this.length=null,this.pos=null,this.remain=null,typeof e.onwarn=="function"&&this.on("warn",e.onwarn);let i=!1;if(!this.preservePaths){const[r,n]=Yn(this.path);r&&(this.path=n,i=r)}this.win32=!!e.win32||process.platform==="win32",this.win32&&(this.path=Go.decode(this.path.replace(/\\/g,"/")),t=t.replace(/\\/g,"/")),this.absolute=st(e.absolute||Lr.resolve(this.cwd,t)),this.path===""&&(this.path="./"),i&&this.warn("TAR_ENTRY_INFO",`stripping ${i} from absolute path`,{entry:this,path:i+this.path}),this.statCache.has(this.absolute)?this[fs](this.statCache.get(this.absolute)):this[Di]()}emit(t,...e){return t==="error"&&(this[Ar]=!0),super.emit(t,...e)}[Di](){it.lstat(this.absolute,(t,e)=>{if(t)return this.emit("error",t);this[fs](e)})}[fs](t){this.statCache.set(this.absolute,t),this.stat=t,t.isFile()||(t.size=0),this.type=Wo(t),this.emit("stat",t),this[Dr]()}[Dr](){switch(this.type){case"File":return this[Nr]();case"Directory":return this[Ir]();case"SymbolicLink":return this[Li]();default:return this.end()}}[Rs](t){return Wn(t,this.type==="Directory",this.portable)}[rt](t){return Gn(t,this.prefix)}[be](){this.type==="Directory"&&this.portable&&(this.noMtime=!0),this.header=new zn({path:this[rt](this.path),linkpath:this.type==="Link"?this[rt](this.linkpath):this.linkpath,mode:this[Rs](this.stat.mode),uid:this.portable?null:this.stat.uid,gid:this.portable?null:this.stat.gid,size:this.stat.size,mtime:this.noMtime?null:this.mtime||this.stat.mtime,type:this.type,uname:this.portable?null:this.stat.uid===this.myuid?this.myuser:"",atime:this.portable?null:this.stat.atime,ctime:this.portable?null:this.stat.ctime}),this.header.encode()&&!this.noPax&&super.write(new kn({atime:this.portable?null:this.header.atime,ctime:this.portable?null:this.header.ctime,gid:this.portable?null:this.header.gid,mtime:this.noMtime?null:this.mtime||this.header.mtime,path:this[rt](this.path),linkpath:this.type==="Link"?this[rt](this.linkpath):this.linkpath,size:this.header.size,uid:this.portable?null:this.header.uid,uname:this.portable?null:this.header.uname,dev:this.portable?null:this.stat.dev,ino:this.portable?null:this.stat.ino,nlink:this.portable?null:this.stat.nlink}).encode()),super.write(this.header.block)}[Ir](){this.path.slice(-1)!=="/"&&(this.path+="/"),this.stat.size=0,this[be](),this.end()}[Li](){it.readlink(this.absolute,(t,e)=>{if(t)return this.emit("error",t);this[Ii](e)})}[Ii](t){this.linkpath=st(t),this[be](),this.end()}[vr](t){this.type="Link",this.linkpath=st(Lr.relative(this.cwd,t)),this.stat.size=0,this[be](),this.end()}[Nr](){if(this.stat.nlink>1){const t=this.stat.dev+":"+this.stat.ino;if(this.linkCache.has(t)){const e=this.linkCache.get(t);if(e.indexOf(this.cwd)===0)return this[vr](e)}this.linkCache.set(t,this.absolute)}if(this[be](),this.stat.size===0)return this.end();this[vi]()}[vi](){it.open(this.absolute,"r",(t,e)=>{if(t)return this.emit("error",t);this[Ai](e)})}[Ai](t){if(this.fd=t,this[Ar])return this[Mt]();this.blockLen=512*Math.ceil(this.stat.size/512),this.blockRemain=this.blockLen;const e=Math.min(this.blockLen,this.maxReadSize);this.buf=Buffer.allocUnsafe(e),this.offset=0,this.pos=0,this.remain=this.stat.size,this.length=this.buf.length,this[us]()}[us](){const{fd:t,buf:e,offset:i,length:r,pos:n}=this;it.read(t,e,i,r,n,(h,o)=>{if(h)return this[Mt](()=>this.emit("error",h));this[Ni](o)})}[Mt](t){it.close(this.fd,t)}[Ni](t){if(t<=0&&this.remain>0){const r=new Error("encountered unexpected EOF");return r.path=this.absolute,r.syscall="read",r.code="EOF",this[Mt](()=>this.emit("error",r))}if(t>this.remain){const r=new Error("did not encounter expected EOF");return r.path=this.absolute,r.syscall="read",r.code="EOF",this[Mt](()=>this.emit("error",r))}if(t===this.remain)for(let r=t;r<this.length&&t<this.blockRemain;r++)this.buf[r+this.offset]=0,t++,this.remain++;const e=this.offset===0&&t===this.buf.length?this.buf:this.buf.slice(this.offset,this.offset+t);this.write(e)?this[si]():this[Mi](()=>this[si]())}[Mi](t){this.once("drain",t)}write(t){if(this.blockRemain<t.length){const e=new Error("writing more data than expected");return e.path=this.absolute,this.emit("error",e)}return this.remain-=t.length,this.blockRemain-=t.length,this.pos+=t.length,this.offset+=t.length,super.write(t)}[si](){if(!this.remain)return this.blockRemain&&super.write(Buffer.alloc(this.blockRemain)),this[Mt](t=>t?this.emit("error",t):this.end());this.offset>=this.length&&(this.buf=Buffer.allocUnsafe(Math.min(this.blockRemain,this.buf.length)),this.offset=0),this.length=this.buf.length-this.offset,this[us]()}});let Ho=class extends Cs{[Di](){this[fs](it.lstatSync(this.absolute))}[Li](){this[Ii](it.readlinkSync(this.absolute))}[vi](){this[Ai](it.openSync(this.absolute,"r"))}[us](){let t=!0;try{const{fd:e,buf:i,offset:r,length:n,pos:h}=this,o=it.readSync(e,i,r,n,h);this[Ni](o),t=!1}finally{if(t)try{this[Mt](()=>{})}catch{}}}[Mi](t){t()}[Mt](t){it.closeSync(this.fd),t()}};const Yo=Hn(class extends Un{constructor(t,e){e=e||{},super(e),this.preservePaths=!!e.preservePaths,this.portable=!!e.portable,this.strict=!!e.strict,this.noPax=!!e.noPax,this.noMtime=!!e.noMtime,this.readEntry=t,this.type=t.type,this.type==="Directory"&&this.portable&&(this.noMtime=!0),this.prefix=e.prefix||null,this.path=st(t.path),this.mode=this[Rs](t.mode),this.uid=this.portable?null:t.uid,this.gid=this.portable?null:t.gid,this.uname=this.portable?null:t.uname,this.gname=this.portable?null:t.gname,this.size=t.size,this.mtime=this.noMtime?null:e.mtime||t.mtime,this.atime=this.portable?null:t.atime,this.ctime=this.portable?null:t.ctime,this.linkpath=st(t.linkpath),typeof e.onwarn=="function"&&this.on("warn",e.onwarn);let i=!1;if(!this.preservePaths){const[r,n]=Yn(this.path);r&&(this.path=n,i=r)}this.remain=t.size,this.blockRemain=t.startBlockSize,this.header=new zn({path:this[rt](this.path),linkpath:this.type==="Link"?this[rt](this.linkpath):this.linkpath,mode:this.mode,uid:this.portable?null:this.uid,gid:this.portable?null:this.gid,size:this.size,mtime:this.noMtime?null:this.mtime,type:this.type,uname:this.portable?null:this.uname,atime:this.portable?null:this.atime,ctime:this.portable?null:this.ctime}),i&&this.warn("TAR_ENTRY_INFO",`stripping ${i} from absolute path`,{entry:this,path:i+this.path}),this.header.encode()&&!this.noPax&&super.write(new kn({atime:this.portable?null:this.atime,ctime:this.portable?null:this.ctime,gid:this.portable?null:this.gid,mtime:this.noMtime?null:this.mtime,path:this[rt](this.path),linkpath:this.type==="Link"?this[rt](this.linkpath):this.linkpath,size:this.size,uid:this.portable?null:this.uid,uname:this.portable?null:this.uname,dev:this.portable?null:this.readEntry.dev,ino:this.portable?null:this.readEntry.ino,nlink:this.portable?null:this.readEntry.nlink}).encode()),super.write(this.header.block),t.pipe(this)}[rt](t){return Gn(t,this.prefix)}[Rs](t){return Wn(t,this.type==="Directory",this.portable)}write(t){const e=t.length;if(e>this.blockRemain)throw new Error("writing more to entry than is appropriate");return this.blockRemain-=e,super.write(t)}end(){return this.blockRemain&&super.write(Buffer.alloc(this.blockRemain)),super.end()}});Cs.Sync=Ho;Cs.Tar=Yo;const Wo=s=>s.isFile()?"File":s.isDirectory()?"Directory":s.isSymbolicLink()?"SymbolicLink":"Unsupported";var Zo=Cs,ii,Mr;function jo(){return Mr||(Mr=1,ii=function(s){s.prototype[Symbol.iterator]=function*(){for(let t=this.head;t;t=t.next)yield t.value}}),ii}var Zn=p;p.Node=Kt;p.create=p;function p(s){var t=this;if(t instanceof p||(t=new p),t.tail=null,t.head=null,t.length=0,s&&typeof s.forEach=="function")s.forEach(function(r){t.push(r)});else if(arguments.length>0)for(var e=0,i=arguments.length;e<i;e++)t.push(arguments[e]);return t}p.prototype.removeNode=function(s){if(s.list!==this)throw new Error("removing node which does not belong to this list");var t=s.next,e=s.prev;return t&&(t.prev=e),e&&(e.next=t),s===this.head&&(this.head=t),s===this.tail&&(this.tail=e),s.list.length--,s.next=null,s.prev=null,s.list=null,t};p.prototype.unshiftNode=function(s){if(s!==this.head){s.list&&s.list.removeNode(s);var t=this.head;s.list=this,s.next=t,t&&(t.prev=s),this.head=s,this.tail||(this.tail=s),this.length++}};p.prototype.pushNode=function(s){if(s!==this.tail){s.list&&s.list.removeNode(s);var t=this.tail;s.list=this,s.prev=t,t&&(t.next=s),this.tail=s,this.head||(this.head=s),this.length++}};p.prototype.push=function(){for(var s=0,t=arguments.length;s<t;s++)Ko(this,arguments[s]);return this.length};p.prototype.unshift=function(){for(var s=0,t=arguments.length;s<t;s++)Vo(this,arguments[s]);return this.length};p.prototype.pop=function(){if(this.tail){var s=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,s}};p.prototype.shift=function(){if(this.head){var s=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,s}};p.prototype.forEach=function(s,t){t=t||this;for(var e=this.head,i=0;e!==null;i++)s.call(t,e.value,i,this),e=e.next};p.prototype.forEachReverse=function(s,t){t=t||this;for(var e=this.tail,i=this.length-1;e!==null;i--)s.call(t,e.value,i,this),e=e.prev};p.prototype.get=function(s){for(var t=0,e=this.head;e!==null&&t<s;t++)e=e.next;if(t===s&&e!==null)return e.value};p.prototype.getReverse=function(s){for(var t=0,e=this.tail;e!==null&&t<s;t++)e=e.prev;if(t===s&&e!==null)return e.value};p.prototype.map=function(s,t){t=t||this;for(var e=new p,i=this.head;i!==null;)e.push(s.call(t,i.value,this)),i=i.next;return e};p.prototype.mapReverse=function(s,t){t=t||this;for(var e=new p,i=this.tail;i!==null;)e.push(s.call(t,i.value,this)),i=i.prev;return e};p.prototype.reduce=function(s,t){var e,i=this.head;if(arguments.length>1)e=t;else if(this.head)i=this.head.next,e=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var r=0;i!==null;r++)e=s(e,i.value,r),i=i.next;return e};p.prototype.reduceReverse=function(s,t){var e,i=this.tail;if(arguments.length>1)e=t;else if(this.tail)i=this.tail.prev,e=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var r=this.length-1;i!==null;r--)e=s(e,i.value,r),i=i.prev;return e};p.prototype.toArray=function(){for(var s=new Array(this.length),t=0,e=this.head;e!==null;t++)s[t]=e.value,e=e.next;return s};p.prototype.toArrayReverse=function(){for(var s=new Array(this.length),t=0,e=this.tail;e!==null;t++)s[t]=e.value,e=e.prev;return s};p.prototype.slice=function(s,t){t=t||this.length,t<0&&(t+=this.length),s=s||0,s<0&&(s+=this.length);var e=new p;if(t<s||t<0)return e;s<0&&(s=0),t>this.length&&(t=this.length);for(var i=0,r=this.head;r!==null&&i<s;i++)r=r.next;for(;r!==null&&i<t;i++,r=r.next)e.push(r.value);return e};p.prototype.sliceReverse=function(s,t){t=t||this.length,t<0&&(t+=this.length),s=s||0,s<0&&(s+=this.length);var e=new p;if(t<s||t<0)return e;s<0&&(s=0),t>this.length&&(t=this.length);for(var i=this.length,r=this.tail;r!==null&&i>t;i--)r=r.prev;for(;r!==null&&i>s;i--,r=r.prev)e.push(r.value);return e};p.prototype.splice=function(s,t,...e){s>this.length&&(s=this.length-1),s<0&&(s=this.length+s);for(var i=0,r=this.head;r!==null&&i<s;i++)r=r.next;for(var n=[],i=0;r&&i<t;i++)n.push(r.value),r=this.removeNode(r);r===null&&(r=this.tail),r!==this.head&&r!==this.tail&&(r=r.prev);for(var i=0;i<e.length;i++)r=qo(this,r,e[i]);return n};p.prototype.reverse=function(){for(var s=this.head,t=this.tail,e=s;e!==null;e=e.prev){var i=e.prev;e.prev=e.next,e.next=i}return this.head=t,this.tail=s,this};function qo(s,t,e){var i=t===s.head?new Kt(e,null,t,s):new Kt(e,t,t.next,s);return i.next===null&&(s.tail=i),i.prev===null&&(s.head=i),s.length++,i}function Ko(s,t){s.tail=new Kt(t,s.tail,null,s),s.head||(s.head=s.tail),s.length++}function Vo(s,t){s.head=new Kt(t,null,s.head,s),s.tail||(s.tail=s.head),s.length++}function Kt(s,t,e,i){if(!(this instanceof Kt))return new Kt(s,t,e,i);this.list=i,this.value=s,t?(t.next=this,this.prev=t):this.prev=null,e?(e.prev=this,this.next=e):this.next=null}try{jo()(p)}catch{}class Cr{constructor(t,e){this.path=t||"./",this.absolute=e,this.entry=null,this.stat=null,this.readdir=null,this.pending=!1,this.ignore=!1,this.piped=!1}}const{Minipass:Xo}=vs,xr=k,Jo=An,tr=Zo,Qo=tr.Sync,tl=tr.Tar,el=Zn,Pr=Buffer.alloc(1024),ds=Symbol("onStat"),qe=Symbol("ended"),Q=Symbol("queue"),Jt=Symbol("current"),zt=Symbol("process"),Ke=Symbol("processing"),Br=Symbol("processJob"),tt=Symbol("jobs"),ri=Symbol("jobDone"),ms=Symbol("addFSEntry"),Fr=Symbol("addTarEntry"),Ci=Symbol("stat"),xi=Symbol("readdir"),ps=Symbol("onreaddir"),Es=Symbol("pipe"),$r=Symbol("entry"),ni=Symbol("entryOpt"),Pi=Symbol("writeEntryClass"),jn=Symbol("write"),hi=Symbol("ondrain"),bs=v,Ur=y,sl=Ji,oi=Be,qn=sl(class extends Xo{constructor(t){if(super(t),t=t||Object.create(null),this.opt=t,this.file=t.file||"",this.cwd=t.cwd||process.cwd(),this.maxReadSize=t.maxReadSize,this.preservePaths=!!t.preservePaths,this.strict=!!t.strict,this.noPax=!!t.noPax,this.prefix=oi(t.prefix||""),this.linkCache=t.linkCache||new Map,this.statCache=t.statCache||new Map,this.readdirCache=t.readdirCache||new Map,this[Pi]=tr,typeof t.onwarn=="function"&&this.on("warn",t.onwarn),this.portable=!!t.portable,this.zip=null,t.gzip||t.brotli){if(t.gzip&&t.brotli)throw new TypeError("gzip and brotli are mutually exclusive");t.gzip&&(typeof t.gzip!="object"&&(t.gzip={}),this.portable&&(t.gzip.portable=!0),this.zip=new xr.Gzip(t.gzip)),t.brotli&&(typeof t.brotli!="object"&&(t.brotli={}),this.zip=new xr.BrotliCompress(t.brotli)),this.zip.on("data",e=>super.write(e)),this.zip.on("end",e=>super.end()),this.zip.on("drain",e=>this[hi]()),this.on("resume",e=>this.zip.resume())}else this.on("drain",this[hi]);this.noDirRecurse=!!t.noDirRecurse,this.follow=!!t.follow,this.noMtime=!!t.noMtime,this.mtime=t.mtime||null,this.filter=typeof t.filter=="function"?t.filter:e=>!0,this[Q]=new el,this[tt]=0,this.jobs=+t.jobs||4,this[Ke]=!1,this[qe]=!1}[jn](t){return super.write(t)}add(t){return this.write(t),this}end(t){return t&&this.write(t),this[qe]=!0,this[zt](),this}write(t){if(this[qe])throw new Error("write after end");return t instanceof Jo?this[Fr](t):this[ms](t),this.flowing}[Fr](t){const e=oi(Ur.resolve(this.cwd,t.path));if(!this.filter(t.path,t))t.resume();else{const i=new Cr(t.path,e,!1);i.entry=new tl(t,this[ni](i)),i.entry.on("end",r=>this[ri](i)),this[tt]+=1,this[Q].push(i)}this[zt]()}[ms](t){const e=oi(Ur.resolve(this.cwd,t));this[Q].push(new Cr(t,e)),this[zt]()}[Ci](t){t.pending=!0,this[tt]+=1;const e=this.follow?"stat":"lstat";bs[e](t.absolute,(i,r)=>{t.pending=!1,this[tt]-=1,i?this.emit("error",i):this[ds](t,r)})}[ds](t,e){this.statCache.set(t.absolute,e),t.stat=e,this.filter(t.path,e)||(t.ignore=!0),this[zt]()}[xi](t){t.pending=!0,this[tt]+=1,bs.readdir(t.absolute,(e,i)=>{if(t.pending=!1,this[tt]-=1,e)return this.emit("error",e);this[ps](t,i)})}[ps](t,e){this.readdirCache.set(t.absolute,e),t.readdir=e,this[zt]()}[zt](){if(!this[Ke]){this[Ke]=!0;for(let t=this[Q].head;t!==null&&this[tt]<this.jobs;t=t.next)if(this[Br](t.value),t.value.ignore){const e=t.next;this[Q].removeNode(t),t.next=e}this[Ke]=!1,this[qe]&&!this[Q].length&&this[tt]===0&&(this.zip?this.zip.end(Pr):(super.write(Pr),super.end()))}}get[Jt](){return this[Q]&&this[Q].head&&this[Q].head.value}[ri](t){this[Q].shift(),this[tt]-=1,this[zt]()}[Br](t){if(!t.pending){if(t.entry){t===this[Jt]&&!t.piped&&this[Es](t);return}if(t.stat||(this.statCache.has(t.absolute)?this[ds](t,this.statCache.get(t.absolute)):this[Ci](t)),!!t.stat&&!t.ignore&&!(!this.noDirRecurse&&t.stat.isDirectory()&&!t.readdir&&(this.readdirCache.has(t.absolute)?this[ps](t,this.readdirCache.get(t.absolute)):this[xi](t),!t.readdir))){if(t.entry=this[$r](t),!t.entry){t.ignore=!0;return}t===this[Jt]&&!t.piped&&this[Es](t)}}}[ni](t){return{onwarn:(e,i,r)=>this.warn(e,i,r),noPax:this.noPax,cwd:this.cwd,absolute:t.absolute,preservePaths:this.preservePaths,maxReadSize:this.maxReadSize,strict:this.strict,portable:this.portable,linkCache:this.linkCache,statCache:this.statCache,noMtime:this.noMtime,mtime:this.mtime,prefix:this.prefix}}[$r](t){this[tt]+=1;try{return new this[Pi](t.path,this[ni](t)).on("end",()=>this[ri](t)).on("error",e=>this.emit("error",e))}catch(e){this.emit("error",e)}}[hi](){this[Jt]&&this[Jt].entry&&this[Jt].entry.resume()}[Es](t){t.piped=!0,t.readdir&&t.readdir.forEach(r=>{const n=t.path,h=n==="./"?"":n.replace(/\/*$/,"/");this[ms](h+r)});const e=t.entry,i=this.zip;i?e.on("data",r=>{i.write(r)||e.pause()}):e.on("data",r=>{super.write(r)||e.pause()})}pause(){return this.zip&&this.zip.pause(),super.pause()}});class il extends qn{constructor(t){super(t),this[Pi]=Qo}pause(){}resume(){}[Ci](t){const e=this.follow?"statSync":"lstatSync";this[ds](t,bs[e](t.absolute))}[xi](t,e){this[ps](t,bs.readdirSync(t.absolute))}[Es](t){const e=t.entry,i=this.zip;t.readdir&&t.readdir.forEach(r=>{const n=t.path,h=n==="./"?"":n.replace(/\/*$/,"/");this[ms](h+r)}),i?e.on("data",r=>{i.write(r)}):e.on("data",r=>{super[jn](r)})}}qn.Sync=il;var ue={};const kr=typeof process=="object"&&process?process:{stdout:null,stderr:null},rl=Pe,zr=ji,Gr=qi.StringDecoder,mt=Symbol("EOF"),pt=Symbol("maybeEmitEnd"),Ot=Symbol("emittedEnd"),Ve=Symbol("emittingEnd"),_e=Symbol("emittedError"),Xe=Symbol("closed"),Hr=Symbol("read"),Je=Symbol("flush"),Yr=Symbol("flushChunk"),$=Symbol("encoding"),Et=Symbol("decoder"),Qe=Symbol("flowing"),Oe=Symbol("paused"),re=Symbol("resume"),D=Symbol("bufferLength"),li=Symbol("bufferPush"),ai=Symbol("bufferShift"),C=Symbol("objectMode"),x=Symbol("destroyed"),ci=Symbol("emitData"),Wr=Symbol("emitEnd"),ui=Symbol("emitEnd2"),yt=Symbol("async"),Te=s=>Promise.resolve().then(s),Kn=Is._MP_NO_ITERATOR_SYMBOLS_!=="1",nl=Kn&&Symbol.asyncIterator||Symbol("asyncIterator not implemented"),hl=Kn&&Symbol.iterator||Symbol("iterator not implemented"),ol=s=>s==="end"||s==="finish"||s==="prefinish",ll=s=>s instanceof ArrayBuffer||typeof s=="object"&&s.constructor&&s.constructor.name==="ArrayBuffer"&&s.byteLength>=0,al=s=>!Buffer.isBuffer(s)&&ArrayBuffer.isView(s);class Vn{constructor(t,e,i){this.src=t,this.dest=e,this.opts=i,this.ondrain=()=>t[re](),e.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(){}end(){this.unpipe(),this.opts.end&&this.dest.end()}}class cl extends Vn{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(t,e,i){super(t,e,i),this.proxyErrors=r=>e.emit("error",r),t.on("error",this.proxyErrors)}}var ul=class Xn extends zr{constructor(t){super(),this[Qe]=!1,this[Oe]=!1,this.pipes=[],this.buffer=[],this[C]=t&&t.objectMode||!1,this[C]?this[$]=null:this[$]=t&&t.encoding||null,this[$]==="buffer"&&(this[$]=null),this[yt]=t&&!!t.async||!1,this[Et]=this[$]?new Gr(this[$]):null,this[mt]=!1,this[Ot]=!1,this[Ve]=!1,this[Xe]=!1,this[_e]=null,this.writable=!0,this.readable=!0,this[D]=0,this[x]=!1}get bufferLength(){return this[D]}get encoding(){return this[$]}set encoding(t){if(this[C])throw new Error("cannot set encoding in objectMode");if(this[$]&&t!==this[$]&&(this[Et]&&this[Et].lastNeed||this[D]))throw new Error("cannot change encoding");this[$]!==t&&(this[Et]=t?new Gr(t):null,this.buffer.length&&(this.buffer=this.buffer.map(e=>this[Et].write(e)))),this[$]=t}setEncoding(t){this.encoding=t}get objectMode(){return this[C]}set objectMode(t){this[C]=this[C]||!!t}get async(){return this[yt]}set async(t){this[yt]=this[yt]||!!t}write(t,e,i){if(this[mt])throw new Error("write after end");if(this[x])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;typeof e=="function"&&(i=e,e="utf8"),e||(e="utf8");const r=this[yt]?Te:n=>n();return!this[C]&&!Buffer.isBuffer(t)&&(al(t)?t=Buffer.from(t.buffer,t.byteOffset,t.byteLength):ll(t)?t=Buffer.from(t):typeof t!="string"&&(this.objectMode=!0)),this[C]?(this.flowing&&this[D]!==0&&this[Je](!0),this.flowing?this.emit("data",t):this[li](t),this[D]!==0&&this.emit("readable"),i&&r(i),this.flowing):t.length?(typeof t=="string"&&!(e===this[$]&&!this[Et].lastNeed)&&(t=Buffer.from(t,e)),Buffer.isBuffer(t)&&this[$]&&(t=this[Et].write(t)),this.flowing&&this[D]!==0&&this[Je](!0),this.flowing?this.emit("data",t):this[li](t),this[D]!==0&&this.emit("readable"),i&&r(i),this.flowing):(this[D]!==0&&this.emit("readable"),i&&r(i),this.flowing)}read(t){if(this[x])return null;if(this[D]===0||t===0||t>this[D])return this[pt](),null;this[C]&&(t=null),this.buffer.length>1&&!this[C]&&(this.encoding?this.buffer=[this.buffer.join("")]:this.buffer=[Buffer.concat(this.buffer,this[D])]);const e=this[Hr](t||null,this.buffer[0]);return this[pt](),e}[Hr](t,e){return t===e.length||t===null?this[ai]():(this.buffer[0]=e.slice(t),e=e.slice(0,t),this[D]-=t),this.emit("data",e),!this.buffer.length&&!this[mt]&&this.emit("drain"),e}end(t,e,i){return typeof t=="function"&&(i=t,t=null),typeof e=="function"&&(i=e,e="utf8"),t&&this.write(t,e),i&&this.once("end",i),this[mt]=!0,this.writable=!1,(this.flowing||!this[Oe])&&this[pt](),this}[re](){this[x]||(this[Oe]=!1,this[Qe]=!0,this.emit("resume"),this.buffer.length?this[Je]():this[mt]?this[pt]():this.emit("drain"))}resume(){return this[re]()}pause(){this[Qe]=!1,this[Oe]=!0}get destroyed(){return this[x]}get flowing(){return this[Qe]}get paused(){return this[Oe]}[li](t){this[C]?this[D]+=1:this[D]+=t.length,this.buffer.push(t)}[ai](){return this.buffer.length&&(this[C]?this[D]-=1:this[D]-=this.buffer[0].length),this.buffer.shift()}[Je](t){do;while(this[Yr](this[ai]()));!t&&!this.buffer.length&&!this[mt]&&this.emit("drain")}[Yr](t){return t?(this.emit("data",t),this.flowing):!1}pipe(t,e){if(this[x])return;const i=this[Ot];return e=e||{},t===kr.stdout||t===kr.stderr?e.end=!1:e.end=e.end!==!1,e.proxyErrors=!!e.proxyErrors,i?e.end&&t.end():(this.pipes.push(e.proxyErrors?new cl(this,t,e):new Vn(this,t,e)),this[yt]?Te(()=>this[re]()):this[re]()),t}unpipe(t){const e=this.pipes.find(i=>i.dest===t);e&&(this.pipes.splice(this.pipes.indexOf(e),1),e.unpipe())}addListener(t,e){return this.on(t,e)}on(t,e){const i=super.on(t,e);return t==="data"&&!this.pipes.length&&!this.flowing?this[re]():t==="readable"&&this[D]!==0?super.emit("readable"):ol(t)&&this[Ot]?(super.emit(t),this.removeAllListeners(t)):t==="error"&&this[_e]&&(this[yt]?Te(()=>e.call(this,this[_e])):e.call(this,this[_e])),i}get emittedEnd(){return this[Ot]}[pt](){!this[Ve]&&!this[Ot]&&!this[x]&&this.buffer.length===0&&this[mt]&&(this[Ve]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[Xe]&&this.emit("close"),this[Ve]=!1)}emit(t,e,...i){if(t!=="error"&&t!=="close"&&t!==x&&this[x])return;if(t==="data")return e?this[yt]?Te(()=>this[ci](e)):this[ci](e):!1;if(t==="end")return this[Wr]();if(t==="close"){if(this[Xe]=!0,!this[Ot]&&!this[x])return;const n=super.emit("close");return this.removeAllListeners("close"),n}else if(t==="error"){this[_e]=e;const n=super.emit("error",e);return this[pt](),n}else if(t==="resume"){const n=super.emit("resume");return this[pt](),n}else if(t==="finish"||t==="prefinish"){const n=super.emit(t);return this.removeAllListeners(t),n}const r=super.emit(t,e,...i);return this[pt](),r}[ci](t){for(const i of this.pipes)i.dest.write(t)===!1&&this.pause();const e=super.emit("data",t);return this[pt](),e}[Wr](){this[Ot]||(this[Ot]=!0,this.readable=!1,this[yt]?Te(()=>this[ui]()):this[ui]())}[ui](){if(this[Et]){const e=this[Et].end();if(e){for(const i of this.pipes)i.dest.write(e);super.emit("data",e)}}for(const e of this.pipes)e.end();const t=super.emit("end");return this.removeAllListeners("end"),t}collect(){const t=[];this[C]||(t.dataLength=0);const e=this.promise();return this.on("data",i=>{t.push(i),this[C]||(t.dataLength+=i.length)}),e.then(()=>t)}concat(){return this[C]?Promise.reject(new Error("cannot concat in objectMode")):this.collect().then(t=>this[C]?Promise.reject(new Error("cannot concat in objectMode")):this[$]?t.join(""):Buffer.concat(t,t.dataLength))}promise(){return new Promise((t,e)=>{this.on(x,()=>e(new Error("stream destroyed"))),this.on("error",i=>e(i)),this.on("end",()=>t())})}[nl](){return{next:()=>{const e=this.read();if(e!==null)return Promise.resolve({done:!1,value:e});if(this[mt])return Promise.resolve({done:!0});let i=null,r=null;const n=l=>{this.removeListener("data",h),this.removeListener("end",o),r(l)},h=l=>{this.removeListener("error",n),this.removeListener("end",o),this.pause(),i({value:l,done:!!this[mt]})},o=()=>{this.removeListener("error",n),this.removeListener("data",h),i({done:!0})},a=()=>n(new Error("stream destroyed"));return new Promise((l,c)=>{r=c,i=l,this.once(x,a),this.once("error",n),this.once("end",o),this.once("data",h)})}}}[hl](){return{next:()=>{const e=this.read();return{value:e,done:e===null}}}}destroy(t){return this[x]?(t?this.emit("error",t):this.emit(x),this):(this[x]=!0,this.buffer.length=0,this[D]=0,typeof this.close=="function"&&!this[Xe]&&this.close(),t?this.emit("error",t):this.emit(x),this)}static isStream(t){return!!t&&(t instanceof Xn||t instanceof zr||t instanceof rl&&(typeof t.pipe=="function"||typeof t.write=="function"&&typeof t.end=="function"))}};const fl=ul,dl=Pe.EventEmitter,z=v;let Bi=z.writev;if(!Bi){const s=process.binding("fs"),t=s.FSReqWrap||s.FSReqCallback;Bi=(e,i,r,n)=>{const h=(a,l)=>n(a,l,i),o=new t;o.oncomplete=h,s.writeBuffers(e,i,r,o)}}const ae=Symbol("_autoClose"),X=Symbol("_close"),Le=Symbol("_ended"),E=Symbol("_fd"),Zr=Symbol("_finished"),xt=Symbol("_flags"),fi=Symbol("_flush"),Fi=Symbol("_handleChunk"),$i=Symbol("_makeBuf"),_s=Symbol("_mode"),ts=Symbol("_needDrain"),oe=Symbol("_onerror"),ce=Symbol("_onopen"),di=Symbol("_onread"),ne=Symbol("_onwrite"),Bt=Symbol("_open"),Rt=Symbol("_path"),Wt=Symbol("_pos"),et=Symbol("_queue"),he=Symbol("_read"),jr=Symbol("_readSize"),Ct=Symbol("_reading"),es=Symbol("_remain"),qr=Symbol("_size"),ys=Symbol("_write"),Qt=Symbol("_writing"),ws=Symbol("_defaultFlag"),le=Symbol("_errored");class Jn extends fl{constructor(t,e){if(e=e||{},super(e),this.readable=!0,this.writable=!1,typeof t!="string")throw new TypeError("path must be a string");this[le]=!1,this[E]=typeof e.fd=="number"?e.fd:null,this[Rt]=t,this[jr]=e.readSize||16*1024*1024,this[Ct]=!1,this[qr]=typeof e.size=="number"?e.size:1/0,this[es]=this[qr],this[ae]=typeof e.autoClose=="boolean"?e.autoClose:!0,typeof this[E]=="number"?this[he]():this[Bt]()}get fd(){return this[E]}get path(){return this[Rt]}write(){throw new TypeError("this is a readable stream")}end(){throw new TypeError("this is a readable stream")}[Bt](){z.open(this[Rt],"r",(t,e)=>this[ce](t,e))}[ce](t,e){t?this[oe](t):(this[E]=e,this.emit("open",e),this[he]())}[$i](){return Buffer.allocUnsafe(Math.min(this[jr],this[es]))}[he](){if(!this[Ct]){this[Ct]=!0;const t=this[$i]();if(t.length===0)return process.nextTick(()=>this[di](null,0,t));z.read(this[E],t,0,t.length,null,(e,i,r)=>this[di](e,i,r))}}[di](t,e,i){this[Ct]=!1,t?this[oe](t):this[Fi](e,i)&&this[he]()}[X](){if(this[ae]&&typeof this[E]=="number"){const t=this[E];this[E]=null,z.close(t,e=>e?this.emit("error",e):this.emit("close"))}}[oe](t){this[Ct]=!0,this[X](),this.emit("error",t)}[Fi](t,e){let i=!1;return this[es]-=t,t>0&&(i=super.write(t<e.length?e.slice(0,t):e)),(t===0||this[es]<=0)&&(i=!1,this[X](),super.end()),i}emit(t,e){switch(t){case"prefinish":case"finish":break;case"drain":typeof this[E]=="number"&&this[he]();break;case"error":return this[le]?void 0:(this[le]=!0,super.emit(t,e));default:return super.emit(t,e)}}}class ml extends Jn{[Bt](){let t=!0;try{this[ce](null,z.openSync(this[Rt],"r")),t=!1}finally{t&&this[X]()}}[he](){let t=!0;try{if(!this[Ct]){this[Ct]=!0;do{const e=this[$i](),i=e.length===0?0:z.readSync(this[E],e,0,e.length,null);if(!this[Fi](i,e))break}while(!0);this[Ct]=!1}t=!1}finally{t&&this[X]()}}[X](){if(this[ae]&&typeof this[E]=="number"){const t=this[E];this[E]=null,z.closeSync(t),this.emit("close")}}}class Qn extends dl{constructor(t,e){e=e||{},super(e),this.readable=!1,this.writable=!0,this[le]=!1,this[Qt]=!1,this[Le]=!1,this[ts]=!1,this[et]=[],this[Rt]=t,this[E]=typeof e.fd=="number"?e.fd:null,this[_s]=e.mode===void 0?438:e.mode,this[Wt]=typeof e.start=="number"?e.start:null,this[ae]=typeof e.autoClose=="boolean"?e.autoClose:!0;const i=this[Wt]!==null?"r+":"w";this[ws]=e.flags===void 0,this[xt]=this[ws]?i:e.flags,this[E]===null&&this[Bt]()}emit(t,e){if(t==="error"){if(this[le])return;this[le]=!0}return super.emit(t,e)}get fd(){return this[E]}get path(){return this[Rt]}[oe](t){this[X](),this[Qt]=!0,this.emit("error",t)}[Bt](){z.open(this[Rt],this[xt],this[_s],(t,e)=>this[ce](t,e))}[ce](t,e){this[ws]&&this[xt]==="r+"&&t&&t.code==="ENOENT"?(this[xt]="w",this[Bt]()):t?this[oe](t):(this[E]=e,this.emit("open",e),this[fi]())}end(t,e){return t&&this.write(t,e),this[Le]=!0,!this[Qt]&&!this[et].length&&typeof this[E]=="number"&&this[ne](null,0),this}write(t,e){return typeof t=="string"&&(t=Buffer.from(t,e)),this[Le]?(this.emit("error",new Error("write() after end()")),!1):this[E]===null||this[Qt]||this[et].length?(this[et].push(t),this[ts]=!0,!1):(this[Qt]=!0,this[ys](t),!0)}[ys](t){z.write(this[E],t,0,t.length,this[Wt],(e,i)=>this[ne](e,i))}[ne](t,e){t?this[oe](t):(this[Wt]!==null&&(this[Wt]+=e),this[et].length?this[fi]():(this[Qt]=!1,this[Le]&&!this[Zr]?(this[Zr]=!0,this[X](),this.emit("finish")):this[ts]&&(this[ts]=!1,this.emit("drain"))))}[fi](){if(this[et].length===0)this[Le]&&this[ne](null,0);else if(this[et].length===1)this[ys](this[et].pop());else{const t=this[et];this[et]=[],Bi(this[E],t,this[Wt],(e,i)=>this[ne](e,i))}}[X](){if(this[ae]&&typeof this[E]=="number"){const t=this[E];this[E]=null,z.close(t,e=>e?this.emit("error",e):this.emit("close"))}}}class pl extends Qn{[Bt](){let t;if(this[ws]&&this[xt]==="r+")try{t=z.openSync(this[Rt],this[xt],this[_s])}catch(e){if(e.code==="ENOENT")return this[xt]="w",this[Bt]();throw e}else t=z.openSync(this[Rt],this[xt],this[_s]);this[ce](null,t)}[X](){if(this[ae]&&typeof this[E]=="number"){const t=this[E];this[E]=null,z.closeSync(t),this.emit("close")}}[ys](t){let e=!0;try{this[ne](null,z.writeSync(this[E],t,0,t.length,this[Wt])),e=!1}finally{if(e)try{this[X]()}catch{}}}}ue.ReadStream=Jn;ue.ReadStreamSync=ml;ue.WriteStream=Qn;ue.WriteStreamSync=pl;const El=Ji,Kr=Xi,yl=Pe,wl=Zn,Sl=1024*1024,gl=An,Vr=Bn,Xr=k,{nextTick:Rl}=Ah,mi=Buffer.from([31,139]),H=Symbol("state"),Gt=Symbol("writeEntry"),wt=Symbol("readEntry"),pi=Symbol("nextEntry"),Jr=Symbol("processEntry"),Y=Symbol("extendedHeader"),De=Symbol("globalExtendedHeader"),Tt=Symbol("meta"),Qr=Symbol("emitMeta"),w=Symbol("buffer"),St=Symbol("queue"),Lt=Symbol("ended"),tn=Symbol("emittedEnd"),Ht=Symbol("emit"),N=Symbol("unzip"),ss=Symbol("consumeChunk"),is=Symbol("consumeChunkSub"),Ei=Symbol("consumeBody"),en=Symbol("consumeMeta"),sn=Symbol("consumeHeader"),rs=Symbol("consuming"),yi=Symbol("bufferConcat"),wi=Symbol("maybeEnd"),Ne=Symbol("writing"),Dt=Symbol("aborted"),ns=Symbol("onDone"),Yt=Symbol("sawValidEntry"),hs=Symbol("sawNullBlock"),os=Symbol("sawEOF"),rn=Symbol("closeStream"),bl=s=>!0;var _l=El(class extends yl{constructor(t){t=t||{},super(t),this.file=t.file||"",this[Yt]=null,this.on(ns,i=>{(this[H]==="begin"||this[Yt]===!1)&&this.warn("TAR_BAD_ARCHIVE","Unrecognized archive format")}),t.ondone?this.on(ns,t.ondone):this.on(ns,i=>{this.emit("prefinish"),this.emit("finish"),this.emit("end")}),this.strict=!!t.strict,this.maxMetaEntrySize=t.maxMetaEntrySize||Sl,this.filter=typeof t.filter=="function"?t.filter:bl;const e=t.file&&(t.file.endsWith(".tar.br")||t.file.endsWith(".tbr"));this.brotli=!t.gzip&&t.brotli!==void 0?t.brotli:e?void 0:!1,this.writable=!0,this.readable=!1,this[St]=new wl,this[w]=null,this[wt]=null,this[Gt]=null,this[H]="begin",this[Tt]="",this[Y]=null,this[De]=null,this[Lt]=!1,this[N]=null,this[Dt]=!1,this[hs]=!1,this[os]=!1,this.on("end",()=>this[rn]()),typeof t.onwarn=="function"&&this.on("warn",t.onwarn),typeof t.onentry=="function"&&this.on("entry",t.onentry)}[sn](t,e){this[Yt]===null&&(this[Yt]=!1);let i;try{i=new Kr(t,e,this[Y],this[De])}catch(r){return this.warn("TAR_ENTRY_INVALID",r)}if(i.nullBlock)this[hs]?(this[os]=!0,this[H]==="begin"&&(this[H]="header"),this[Ht]("eof")):(this[hs]=!0,this[Ht]("nullBlock"));else if(this[hs]=!1,!i.cksumValid)this.warn("TAR_ENTRY_INVALID","checksum failure",{header:i});else if(!i.path)this.warn("TAR_ENTRY_INVALID","path is required",{header:i});else{const r=i.type;if(/^(Symbolic)?Link$/.test(r)&&!i.linkpath)this.warn("TAR_ENTRY_INVALID","linkpath required",{header:i});else if(!/^(Symbolic)?Link$/.test(r)&&i.linkpath)this.warn("TAR_ENTRY_INVALID","linkpath forbidden",{header:i});else{const n=this[Gt]=new gl(i,this[Y],this[De]);if(!this[Yt])if(n.remain){const h=()=>{n.invalid||(this[Yt]=!0)};n.on("end",h)}else this[Yt]=!0;n.meta?n.size>this.maxMetaEntrySize?(n.ignore=!0,this[Ht]("ignoredEntry",n),this[H]="ignore",n.resume()):n.size>0&&(this[Tt]="",n.on("data",h=>this[Tt]+=h),this[H]="meta"):(this[Y]=null,n.ignore=n.ignore||!this.filter(n.path,n),n.ignore?(this[Ht]("ignoredEntry",n),this[H]=n.remain?"ignore":"header",n.resume()):(n.remain?this[H]="body":(this[H]="header",n.end()),this[wt]?this[St].push(n):(this[St].push(n),this[pi]())))}}}[rn](){Rl(()=>this.emit("close"))}[Jr](t){let e=!0;return t?Array.isArray(t)?this.emit.apply(this,t):(this[wt]=t,this.emit("entry",t),t.emittedEnd||(t.on("end",i=>this[pi]()),e=!1)):(this[wt]=null,e=!1),e}[pi](){do;while(this[Jr](this[St].shift()));if(!this[St].length){const t=this[wt];!t||t.flowing||t.size===t.remain?this[Ne]||this.emit("drain"):t.once("drain",i=>this.emit("drain"))}}[Ei](t,e){const i=this[Gt],r=i.blockRemain,n=r>=t.length&&e===0?t:t.slice(e,e+r);return i.write(n),i.blockRemain||(this[H]="header",this[Gt]=null,i.end()),n.length}[en](t,e){const i=this[Gt],r=this[Ei](t,e);return this[Gt]||this[Qr](i),r}[Ht](t,e,i){!this[St].length&&!this[wt]?this.emit(t,e,i):this[St].push([t,e,i])}[Qr](t){switch(this[Ht]("meta",this[Tt]),t.type){case"ExtendedHeader":case"OldExtendedHeader":this[Y]=Vr.parse(this[Tt],this[Y],!1);break;case"GlobalExtendedHeader":this[De]=Vr.parse(this[Tt],this[De],!0);break;case"NextFileHasLongPath":case"OldGnuLongPath":this[Y]=this[Y]||Object.create(null),this[Y].path=this[Tt].replace(/\0.*/,"");break;case"NextFileHasLongLinkpath":this[Y]=this[Y]||Object.create(null),this[Y].linkpath=this[Tt].replace(/\0.*/,"");break;default:throw new Error("unknown meta: "+t.type)}}abort(t){this[Dt]=!0,this.emit("abort",t),this.warn("TAR_ABORT",t,{recoverable:!1})}write(t){if(this[Dt])return;if((this[N]===null||this.brotli===void 0&&this[N]===!1)&&t){if(this[w]&&(t=Buffer.concat([this[w],t]),this[w]=null),t.length<mi.length)return this[w]=t,!0;for(let n=0;this[N]===null&&n<mi.length;n++)t[n]!==mi[n]&&(this[N]=!1);const r=this.brotli===void 0;if(this[N]===!1&&r)if(t.length<512)if(this[Lt])this.brotli=!0;else return this[w]=t,!0;else try{new Kr(t.slice(0,512)),this.brotli=!1}catch{this.brotli=!0}if(this[N]===null||this[N]===!1&&this.brotli){const n=this[Lt];this[Lt]=!1,this[N]=this[N]===null?new Xr.Unzip:new Xr.BrotliDecompress,this[N].on("data",o=>this[ss](o)),this[N].on("error",o=>this.abort(o)),this[N].on("end",o=>{this[Lt]=!0,this[ss]()}),this[Ne]=!0;const h=this[N][n?"end":"write"](t);return this[Ne]=!1,h}}this[Ne]=!0,this[N]?this[N].write(t):this[ss](t),this[Ne]=!1;const i=this[St].length?!1:this[wt]?this[wt].flowing:!0;return!i&&!this[St].length&&this[wt].once("drain",r=>this.emit("drain")),i}[yi](t){t&&!this[Dt]&&(this[w]=this[w]?Buffer.concat([this[w],t]):t)}[wi](){if(this[Lt]&&!this[tn]&&!this[Dt]&&!this[rs]){this[tn]=!0;const t=this[Gt];if(t&&t.blockRemain){const e=this[w]?this[w].length:0;this.warn("TAR_BAD_ARCHIVE",`Truncated input (needed ${t.blockRemain} more bytes, only ${e} available)`,{entry:t}),this[w]&&t.write(this[w]),t.end()}this[Ht](ns)}}[ss](t){if(this[rs])this[yi](t);else if(!t&&!this[w])this[wi]();else{if(this[rs]=!0,this[w]){this[yi](t);const e=this[w];this[w]=null,this[is](e)}else this[is](t);for(;this[w]&&this[w].length>=512&&!this[Dt]&&!this[os];){const e=this[w];this[w]=null,this[is](e)}this[rs]=!1}(!this[w]||this[Lt])&&this[wi]()}[is](t){let e=0;const i=t.length;for(;e+512<=i&&!this[Dt]&&!this[os];)switch(this[H]){case"begin":case"header":this[sn](t,e),e+=512;break;case"ignore":case"body":e+=this[Ei](t,e);break;case"meta":e+=this[en](t,e);break;default:throw new Error("invalid state: "+this[H])}e<i&&(this[w]?this[w]=Buffer.concat([t.slice(e),this[w]]):this[w]=t.slice(e))}end(t){this[Dt]||(this[N]?this[N].end(t):(this[Lt]=!0,this.brotli===void 0&&(t=t||Buffer.alloc(0)),this.write(t)))}}),er={exports:{}};const{promisify:nn}=Mh,Nt=v,Ol=s=>{if(!s)s={mode:511,fs:Nt};else if(typeof s=="object")s={mode:511,fs:Nt,...s};else if(typeof s=="number")s={mode:s,fs:Nt};else if(typeof s=="string")s={mode:parseInt(s,8),fs:Nt};else throw new TypeError("invalid options argument");return s.mkdir=s.mkdir||s.fs.mkdir||Nt.mkdir,s.mkdirAsync=nn(s.mkdir),s.stat=s.stat||s.fs.stat||Nt.stat,s.statAsync=nn(s.stat),s.statSync=s.statSync||s.fs.statSync||Nt.statSync,s.mkdirSync=s.mkdirSync||s.fs.mkdirSync||Nt.mkdirSync,s};var Tl=Ol;const Ll=process.env.__TESTING_MKDIRP_PLATFORM__||process.platform,{resolve:Dl,parse:Nl}=y,Il=s=>{if(/\0/.test(s))throw Object.assign(new TypeError("path must be a string without null bytes"),{path:s,code:"ERR_INVALID_ARG_VALUE"});if(s=Dl(s),Ll==="win32"){const t=/[*|"<>?:]/,{root:e}=Nl(s);if(t.test(s.substr(e.length)))throw Object.assign(new Error("Illegal characters in path."),{path:s,code:"EINVAL"})}return s};var vl=Il;const{dirname:th}=y,eh=(s,t,e=void 0)=>e===t?Promise.resolve():s.statAsync(t).then(i=>i.isDirectory()?e:void 0,i=>i.code==="ENOENT"?eh(s,th(t),t):void 0),sh=(s,t,e=void 0)=>{if(e!==t)try{return s.statSync(t).isDirectory()?e:void 0}catch(i){return i.code==="ENOENT"?sh(s,th(t),t):void 0}};var Al={findMade:eh,findMadeSync:sh};const{dirname:ih}=y,Ui=(s,t,e)=>{t.recursive=!1;const i=ih(s);return i===s?t.mkdirAsync(s,t).catch(r=>{if(r.code!=="EISDIR")throw r}):t.mkdirAsync(s,t).then(()=>e||s,r=>{if(r.code==="ENOENT")return Ui(i,t).then(n=>Ui(s,t,n));if(r.code!=="EEXIST"&&r.code!=="EROFS")throw r;return t.statAsync(s).then(n=>{if(n.isDirectory())return e;throw r},()=>{throw r})})},ki=(s,t,e)=>{const i=ih(s);if(t.recursive=!1,i===s)try{return t.mkdirSync(s,t)}catch(r){if(r.code!=="EISDIR")throw r;return}try{return t.mkdirSync(s,t),e||s}catch(r){if(r.code==="ENOENT")return ki(s,t,ki(i,t,e));if(r.code!=="EEXIST"&&r.code!=="EROFS")throw r;try{if(!t.statSync(s).isDirectory())throw r}catch{throw r}}};var rh={mkdirpManual:Ui,mkdirpManualSync:ki};const{dirname:nh}=y,{findMade:Ml,findMadeSync:Cl}=Al,{mkdirpManual:xl,mkdirpManualSync:Pl}=rh,Bl=(s,t)=>(t.recursive=!0,nh(s)===s?t.mkdirAsync(s,t):Ml(t,s).then(i=>t.mkdirAsync(s,t).then(()=>i).catch(r=>{if(r.code==="ENOENT")return xl(s,t);throw r}))),Fl=(s,t)=>{if(t.recursive=!0,nh(s)===s)return t.mkdirSync(s,t);const i=Cl(t,s);try{return t.mkdirSync(s,t),i}catch(r){if(r.code==="ENOENT")return Pl(s,t);throw r}};var $l={mkdirpNative:Bl,mkdirpNativeSync:Fl};const hh=v,Ul=process.env.__TESTING_MKDIRP_NODE_VERSION__||process.version,Si=Ul.replace(/^v/,"").split("."),oh=+Si[0]>10||+Si[0]==10&&+Si[1]>=12,kl=oh?s=>s.mkdir===hh.mkdir:()=>!1,zl=oh?s=>s.mkdirSync===hh.mkdirSync:()=>!1;var Gl={useNative:kl,useNativeSync:zl};const fe=Tl,de=vl,{mkdirpNative:lh,mkdirpNativeSync:ah}=$l,{mkdirpManual:ch,mkdirpManualSync:uh}=rh,{useNative:Hl,useNativeSync:Yl}=Gl,me=(s,t)=>(s=de(s),t=fe(t),Hl(t)?lh(s,t):ch(s,t)),Wl=(s,t)=>(s=de(s),t=fe(t),Yl(t)?ah(s,t):uh(s,t));me.sync=Wl;me.native=(s,t)=>lh(de(s),fe(t));me.manual=(s,t)=>ch(de(s),fe(t));me.nativeSync=(s,t)=>ah(de(s),fe(t));me.manualSync=(s,t)=>uh(de(s),fe(t));var Zl=me;const q=v,qt=y,jl=q.lchown?"lchown":"chown",ql=q.lchownSync?"lchownSync":"chownSync",fh=q.lchown&&!process.version.match(/v1[1-9]+\./)&&!process.version.match(/v10\.[6-9]/),hn=(s,t,e)=>{try{return q[ql](s,t,e)}catch(i){if(i.code!=="ENOENT")throw i}},Kl=(s,t,e)=>{try{return q.chownSync(s,t,e)}catch(i){if(i.code!=="ENOENT")throw i}},Vl=fh?(s,t,e,i)=>r=>{!r||r.code!=="EISDIR"?i(r):q.chown(s,t,e,i)}:(s,t,e,i)=>i,zi=fh?(s,t,e)=>{try{return hn(s,t,e)}catch(i){if(i.code!=="EISDIR")throw i;Kl(s,t,e)}}:(s,t,e)=>hn(s,t,e),Xl=process.version;let dh=(s,t,e)=>q.readdir(s,t,e),Jl=(s,t)=>q.readdirSync(s,t);/^v4\./.test(Xl)&&(dh=(s,t,e)=>q.readdir(s,e));const Os=(s,t,e,i)=>{q[jl](s,t,e,Vl(s,t,e,r=>{i(r&&r.code!=="ENOENT"?r:null)}))},mh=(s,t,e,i,r)=>{if(typeof t=="string")return q.lstat(qt.resolve(s,t),(n,h)=>{if(n)return r(n.code!=="ENOENT"?n:null);h.name=t,mh(s,h,e,i,r)});if(t.isDirectory())sr(qt.resolve(s,t.name),e,i,n=>{if(n)return r(n);const h=qt.resolve(s,t.name);Os(h,e,i,r)});else{const n=qt.resolve(s,t.name);Os(n,e,i,r)}},sr=(s,t,e,i)=>{dh(s,{withFileTypes:!0},(r,n)=>{if(r){if(r.code==="ENOENT")return i();if(r.code!=="ENOTDIR"&&r.code!=="ENOTSUP")return i(r)}if(r||!n.length)return Os(s,t,e,i);let h=n.length,o=null;const a=l=>{if(!o){if(l)return i(o=l);if(--h===0)return Os(s,t,e,i)}};n.forEach(l=>mh(s,l,t,e,a))})},Ql=(s,t,e,i)=>{if(typeof t=="string")try{const r=q.lstatSync(qt.resolve(s,t));r.name=t,t=r}catch(r){if(r.code==="ENOENT")return;throw r}t.isDirectory()&&ph(qt.resolve(s,t.name),e,i),zi(qt.resolve(s,t.name),e,i)},ph=(s,t,e)=>{let i;try{i=Jl(s,{withFileTypes:!0})}catch(r){if(r.code==="ENOENT")return;if(r.code==="ENOTDIR"||r.code==="ENOTSUP")return zi(s,t,e);throw r}return i&&i.length&&i.forEach(r=>Ql(s,r,t,e)),zi(s,t,e)};var ta=sr;sr.sync=ph;const Eh=Zl,j=v,Ts=y,yh=ta,V=Be;class wh extends Error{constructor(t,e){super("Cannot extract through symbolic link"),this.path=e,this.symlink=t}get name(){return"SylinkError"}}class Sh extends Error{constructor(t,e){super(e+": Cannot cd into '"+t+"'"),this.path=t,this.code=e}get name(){return"CwdError"}}const Ls=(s,t)=>s.get(V(t)),Ie=(s,t,e)=>s.set(V(t),e),ea=(s,t)=>{j.stat(s,(e,i)=>{(e||!i.isDirectory())&&(e=new Sh(s,e&&e.code||"ENOTDIR")),t(e)})};er.exports=(s,t,e)=>{s=V(s);const i=t.umask,r=t.mode|448,n=(r&i)!==0,h=t.uid,o=t.gid,a=typeof h=="number"&&typeof o=="number"&&(h!==t.processUid||o!==t.processGid),l=t.preserve,c=t.unlink,u=t.cache,f=V(t.cwd),d=(K,O)=>{K?e(K):(Ie(u,s,!0),O&&a?yh(O,h,o,nr=>d(nr)):n?j.chmod(s,r,e):e())};if(u&&Ls(u,s)===!0)return d();if(s===f)return ea(s,d);if(l)return Eh(s,{mode:r}).then(K=>d(null,K),d);const nt=V(Ts.relative(f,s)).split("/");Ds(f,nt,r,u,c,f,null,d)};const Ds=(s,t,e,i,r,n,h,o)=>{if(!t.length)return o(null,h);const a=t.shift(),l=V(Ts.resolve(s+"/"+a));if(Ls(i,l))return Ds(l,t,e,i,r,n,h,o);j.mkdir(l,e,gh(l,t,e,i,r,n,h,o))},gh=(s,t,e,i,r,n,h,o)=>a=>{a?j.lstat(s,(l,c)=>{if(l)l.path=l.path&&V(l.path),o(l);else if(c.isDirectory())Ds(s,t,e,i,r,n,h,o);else if(r)j.unlink(s,u=>{if(u)return o(u);j.mkdir(s,e,gh(s,t,e,i,r,n,h,o))});else{if(c.isSymbolicLink())return o(new wh(s,s+"/"+t.join("/")));o(a)}}):(h=h||s,Ds(s,t,e,i,r,n,h,o))},sa=s=>{let t=!1,e="ENOTDIR";try{t=j.statSync(s).isDirectory()}catch(i){e=i.code}finally{if(!t)throw new Sh(s,e)}};er.exports.sync=(s,t)=>{s=V(s);const e=t.umask,i=t.mode|448,r=(i&e)!==0,n=t.uid,h=t.gid,o=typeof n=="number"&&typeof h=="number"&&(n!==t.processUid||h!==t.processGid),a=t.preserve,l=t.unlink,c=t.cache,u=V(t.cwd),f=K=>{Ie(c,s,!0),K&&o&&yh.sync(K,n,h),r&&j.chmodSync(s,i)};if(c&&Ls(c,s)===!0)return f();if(s===u)return sa(u),f();if(a)return f(Eh.sync(s,i));const g=V(Ts.relative(u,s)).split("/");let nt=null;for(let K=g.shift(),O=u;K&&(O+="/"+K);K=g.shift())if(O=V(Ts.resolve(O)),!Ls(c,O))try{j.mkdirSync(O,i),nt=nt||O,Ie(c,O,!0)}catch{const hr=j.lstatSync(O);if(hr.isDirectory()){Ie(c,O,!0);continue}else if(l){j.unlinkSync(O),j.mkdirSync(O,i),nt=nt||O,Ie(c,O,!0);continue}else if(hr.isSymbolicLink())return new wh(O,O+"/"+g.join("/"))}return f(nt)};var ia=er.exports;const gi=Object.create(null),{hasOwnProperty:ra}=Object.prototype;var Rh=s=>(ra.call(gi,s)||(gi[s]=s.normalize("NFD")),gi[s]);const on=Ki,na=Rh,ha=As,{join:ln}=y,oa=process.env.TESTING_TAR_FAKE_PLATFORM||process.platform,la=oa==="win32";var aa=()=>{const s=new Map,t=new Map,e=l=>l.split("/").slice(0,-1).reduce((u,f)=>(u.length&&(f=ln(u[u.length-1],f)),u.push(f||"/"),u),[]),i=new Set,r=l=>{const c=t.get(l);if(!c)throw new Error("function does not have any path reservations");return{paths:c.paths.map(u=>s.get(u)),dirs:[...c.dirs].map(u=>s.get(u))}},n=l=>{const{paths:c,dirs:u}=r(l);return c.every(f=>f[0]===l)&&u.every(f=>f[0]instanceof Set&&f[0].has(l))},h=l=>i.has(l)||!n(l)?!1:(i.add(l),l(()=>o(l)),!0),o=l=>{if(!i.has(l))return!1;const{paths:c,dirs:u}=t.get(l),f=new Set;return c.forEach(d=>{const g=s.get(d);on.equal(g[0],l),g.length===1?s.delete(d):(g.shift(),typeof g[0]=="function"?f.add(g[0]):g[0].forEach(nt=>f.add(nt)))}),u.forEach(d=>{const g=s.get(d);on(g[0]instanceof Set),g[0].size===1&&g.length===1?s.delete(d):g[0].size===1?(g.shift(),f.add(g[0])):g[0].delete(l)}),i.delete(l),f.forEach(d=>h(d)),!0};return{check:n,reserve:(l,c)=>{l=la?["win32 parallelization disabled"]:l.map(f=>ha(ln(na(f))).toLowerCase());const u=new Set(l.map(f=>e(f)).reduce((f,d)=>f.concat(d)));return t.set(c,{dirs:u,paths:l}),l.forEach(f=>{const d=s.get(f);d?d.push(c):s.set(f,[c])}),u.forEach(f=>{const d=s.get(f);d?d[d.length-1]instanceof Set?d[d.length-1].add(c):d.push(new Set([c])):s.set(f,[new Set([c])])}),h(c)}}};const ca=process.env.__FAKE_PLATFORM__||process.platform,ua=ca==="win32",fa=Is.__FAKE_TESTING_FS__||v,{O_CREAT:da,O_TRUNC:ma,O_WRONLY:pa,UV_FS_O_FILEMAP:bh=0}=fa.constants,Ea=ua&&!!bh,ya=512*1024,wa=bh|ma|da|pa;var Sa=Ea?s=>s<ya?wa:"w":()=>"w";const ga=Ki,Ra=_l,m=v,ba=ue,gt=y,_h=ia,an=Fn,_a=aa,Oa=$n,W=Be,Ta=As,La=Rh,cn=Symbol("onEntry"),Gi=Symbol("checkFs"),un=Symbol("checkFs2"),Ss=Symbol("pruneCache"),Hi=Symbol("isReusable"),Z=Symbol("makeFs"),Yi=Symbol("file"),Wi=Symbol("directory"),gs=Symbol("link"),fn=Symbol("symlink"),dn=Symbol("hardlink"),mn=Symbol("unsupported"),pn=Symbol("checkPath"),Pt=Symbol("mkdir"),P=Symbol("onError"),ls=Symbol("pending"),En=Symbol("pend"),te=Symbol("unpend"),Ri=Symbol("ended"),bi=Symbol("maybeClose"),Zi=Symbol("skip"),ve=Symbol("doChown"),Ae=Symbol("uid"),Me=Symbol("gid"),Ce=Symbol("checkedCwd"),Oh=Ch,Th=Sa,Da=process.env.TESTING_TAR_FAKE_PLATFORM||process.platform,xe=Da==="win32",Na=1024,Ia=(s,t)=>{if(!xe)return m.unlink(s,t);const e=s+".DELETE."+Oh.randomBytes(16).toString("hex");m.rename(s,e,i=>{if(i)return t(i);m.unlink(e,t)})},va=s=>{if(!xe)return m.unlinkSync(s);const t=s+".DELETE."+Oh.randomBytes(16).toString("hex");m.renameSync(s,t),m.unlinkSync(t)},yn=(s,t,e)=>s===s>>>0?s:t===t>>>0?t:e,wn=s=>Ta(W(La(s))).toLowerCase(),Aa=(s,t)=>{t=wn(t);for(const e of s.keys()){const i=wn(e);(i===t||i.indexOf(t+"/")===0)&&s.delete(e)}},Ma=s=>{for(const t of s.keys())s.delete(t)};let ir=class extends Ra{constructor(t){if(t||(t={}),t.ondone=e=>{this[Ri]=!0,this[bi]()},super(t),this[Ce]=!1,this.reservations=_a(),this.transform=typeof t.transform=="function"?t.transform:null,this.writable=!0,this.readable=!1,this[ls]=0,this[Ri]=!1,this.dirCache=t.dirCache||new Map,typeof t.uid=="number"||typeof t.gid=="number"){if(typeof t.uid!="number"||typeof t.gid!="number")throw new TypeError("cannot set owner without number uid and gid");if(t.preserveOwner)throw new TypeError("cannot preserve owner in archive and also set owner explicitly");this.uid=t.uid,this.gid=t.gid,this.setOwner=!0}else this.uid=null,this.gid=null,this.setOwner=!1;t.preserveOwner===void 0&&typeof t.uid!="number"?this.preserveOwner=process.getuid&&process.getuid()===0:this.preserveOwner=!!t.preserveOwner,this.processUid=(this.preserveOwner||this.setOwner)&&process.getuid?process.getuid():null,this.processGid=(this.preserveOwner||this.setOwner)&&process.getgid?process.getgid():null,this.maxDepth=typeof t.maxDepth=="number"?t.maxDepth:Na,this.forceChown=t.forceChown===!0,this.win32=!!t.win32||xe,this.newer=!!t.newer,this.keep=!!t.keep,this.noMtime=!!t.noMtime,this.preservePaths=!!t.preservePaths,this.unlink=!!t.unlink,this.cwd=W(gt.resolve(t.cwd||process.cwd())),this.strip=+t.strip||0,this.processUmask=t.noChmod?0:process.umask(),this.umask=typeof t.umask=="number"?t.umask:this.processUmask,this.dmode=t.dmode||511&~this.umask,this.fmode=t.fmode||438&~this.umask,this.on("entry",e=>this[cn](e))}warn(t,e,i={}){return(t==="TAR_BAD_ARCHIVE"||t==="TAR_ABORT")&&(i.recoverable=!1),super.warn(t,e,i)}[bi](){this[Ri]&&this[ls]===0&&(this.emit("prefinish"),this.emit("finish"),this.emit("end"))}[pn](t){const e=W(t.path),i=e.split("/");if(this.strip){if(i.length<this.strip)return!1;if(t.type==="Link"){const r=W(t.linkpath).split("/");if(r.length>=this.strip)t.linkpath=r.slice(this.strip).join("/");else return!1}i.splice(0,this.strip),t.path=i.join("/")}if(isFinite(this.maxDepth)&&i.length>this.maxDepth)return this.warn("TAR_ENTRY_ERROR","path excessively deep",{entry:t,path:e,depth:i.length,maxDepth:this.maxDepth}),!1;if(!this.preservePaths){if(i.includes("..")||xe&&/^[a-z]:\.\.$/i.test(i[0]))return this.warn("TAR_ENTRY_ERROR","path contains '..'",{entry:t,path:e}),!1;const[r,n]=Oa(e);r&&(t.path=n,this.warn("TAR_ENTRY_INFO",`stripping ${r} from absolute path`,{entry:t,path:e}))}if(gt.isAbsolute(t.path)?t.absolute=W(gt.resolve(t.path)):t.absolute=W(gt.resolve(this.cwd,t.path)),!this.preservePaths&&t.absolute.indexOf(this.cwd+"/")!==0&&t.absolute!==this.cwd)return this.warn("TAR_ENTRY_ERROR","path escaped extraction target",{entry:t,path:W(t.path),resolvedPath:t.absolute,cwd:this.cwd}),!1;if(t.absolute===this.cwd&&t.type!=="Directory"&&t.type!=="GNUDumpDir")return!1;if(this.win32){const{root:r}=gt.win32.parse(t.absolute);t.absolute=r+an.encode(t.absolute.slice(r.length));const{root:n}=gt.win32.parse(t.path);t.path=n+an.encode(t.path.slice(n.length))}return!0}[cn](t){if(!this[pn](t))return t.resume();switch(ga.equal(typeof t.absolute,"string"),t.type){case"Directory":case"GNUDumpDir":t.mode&&(t.mode=t.mode|448);case"File":case"OldFile":case"ContiguousFile":case"Link":case"SymbolicLink":return this[Gi](t);case"CharacterDevice":case"BlockDevice":case"FIFO":default:return this[mn](t)}}[P](t,e){t.name==="CwdError"?this.emit("error",t):(this.warn("TAR_ENTRY_ERROR",t,{entry:e}),this[te](),e.resume())}[Pt](t,e,i){_h(W(t),{uid:this.uid,gid:this.gid,processUid:this.processUid,processGid:this.processGid,umask:this.processUmask,preserve:this.preservePaths,unlink:this.unlink,cache:this.dirCache,cwd:this.cwd,mode:e,noChmod:this.noChmod},i)}[ve](t){return this.forceChown||this.preserveOwner&&(typeof t.uid=="number"&&t.uid!==this.processUid||typeof t.gid=="number"&&t.gid!==this.processGid)||typeof this.uid=="number"&&this.uid!==this.processUid||typeof this.gid=="number"&&this.gid!==this.processGid}[Ae](t){return yn(this.uid,t.uid,this.processUid)}[Me](t){return yn(this.gid,t.gid,this.processGid)}[Yi](t,e){const i=t.mode&4095||this.fmode,r=new ba.WriteStream(t.absolute,{flags:Th(t.size),mode:i,autoClose:!1});r.on("error",a=>{r.fd&&m.close(r.fd,()=>{}),r.write=()=>!0,this[P](a,t),e()});let n=1;const h=a=>{if(a){r.fd&&m.close(r.fd,()=>{}),this[P](a,t),e();return}--n===0&&m.close(r.fd,l=>{l?this[P](l,t):this[te](),e()})};r.on("finish",a=>{const l=t.absolute,c=r.fd;if(t.mtime&&!this.noMtime){n++;const u=t.atime||new Date,f=t.mtime;m.futimes(c,u,f,d=>d?m.utimes(l,u,f,g=>h(g&&d)):h())}if(this[ve](t)){n++;const u=this[Ae](t),f=this[Me](t);m.fchown(c,u,f,d=>d?m.chown(l,u,f,g=>h(g&&d)):h())}h()});const o=this.transform&&this.transform(t)||t;o!==t&&(o.on("error",a=>{this[P](a,t),e()}),t.pipe(o)),o.pipe(r)}[Wi](t,e){const i=t.mode&4095||this.dmode;this[Pt](t.absolute,i,r=>{if(r){this[P](r,t),e();return}let n=1;const h=o=>{--n===0&&(e(),this[te](),t.resume())};t.mtime&&!this.noMtime&&(n++,m.utimes(t.absolute,t.atime||new Date,t.mtime,h)),this[ve](t)&&(n++,m.chown(t.absolute,this[Ae](t),this[Me](t),h)),h()})}[mn](t){t.unsupported=!0,this.warn("TAR_ENTRY_UNSUPPORTED",`unsupported entry type: ${t.type}`,{entry:t}),t.resume()}[fn](t,e){this[gs](t,t.linkpath,"symlink",e)}[dn](t,e){const i=W(gt.resolve(this.cwd,t.linkpath));this[gs](t,i,"link",e)}[En](){this[ls]++}[te](){this[ls]--,this[bi]()}[Zi](t){this[te](),t.resume()}[Hi](t,e){return t.type==="File"&&!this.unlink&&e.isFile()&&e.nlink<=1&&!xe}[Gi](t){this[En]();const e=[t.path];t.linkpath&&e.push(t.linkpath),this.reservations.reserve(e,i=>this[un](t,i))}[Ss](t){t.type==="SymbolicLink"?Ma(this.dirCache):t.type!=="Directory"&&Aa(this.dirCache,t.absolute)}[un](t,e){this[Ss](t);const i=o=>{this[Ss](t),e(o)},r=()=>{this[Pt](this.cwd,this.dmode,o=>{if(o){this[P](o,t),i();return}this[Ce]=!0,n()})},n=()=>{if(t.absolute!==this.cwd){const o=W(gt.dirname(t.absolute));if(o!==this.cwd)return this[Pt](o,this.dmode,a=>{if(a){this[P](a,t),i();return}h()})}h()},h=()=>{m.lstat(t.absolute,(o,a)=>{if(a&&(this.keep||this.newer&&a.mtime>t.mtime)){this[Zi](t),i();return}if(o||this[Hi](t,a))return this[Z](null,t,i);if(a.isDirectory()){if(t.type==="Directory"){const l=!this.noChmod&&t.mode&&(a.mode&4095)!==t.mode,c=u=>this[Z](u,t,i);return l?m.chmod(t.absolute,t.mode,c):c()}if(t.absolute!==this.cwd)return m.rmdir(t.absolute,l=>this[Z](l,t,i))}if(t.absolute===this.cwd)return this[Z](null,t,i);Ia(t.absolute,l=>this[Z](l,t,i))})};this[Ce]?n():r()}[Z](t,e,i){if(t){this[P](t,e),i();return}switch(e.type){case"File":case"OldFile":case"ContiguousFile":return this[Yi](e,i);case"Link":return this[dn](e,i);case"SymbolicLink":return this[fn](e,i);case"Directory":case"GNUDumpDir":return this[Wi](e,i)}}[gs](t,e,i,r){m[i](e,t.absolute,n=>{n?this[P](n,t):(this[te](),t.resume()),r()})}};const as=s=>{try{return[null,s()]}catch(t){return[t,null]}};class Ca extends ir{[Z](t,e){return super[Z](t,e,()=>{})}[Gi](t){if(this[Ss](t),!this[Ce]){const n=this[Pt](this.cwd,this.dmode);if(n)return this[P](n,t);this[Ce]=!0}if(t.absolute!==this.cwd){const n=W(gt.dirname(t.absolute));if(n!==this.cwd){const h=this[Pt](n,this.dmode);if(h)return this[P](h,t)}}const[e,i]=as(()=>m.lstatSync(t.absolute));if(i&&(this.keep||this.newer&&i.mtime>t.mtime))return this[Zi](t);if(e||this[Hi](t,i))return this[Z](null,t);if(i.isDirectory()){if(t.type==="Directory"){const h=!this.noChmod&&t.mode&&(i.mode&4095)!==t.mode,[o]=h?as(()=>{m.chmodSync(t.absolute,t.mode)}):[];return this[Z](o,t)}const[n]=as(()=>m.rmdirSync(t.absolute));this[Z](n,t)}const[r]=t.absolute===this.cwd?[]:as(()=>va(t.absolute));this[Z](r,t)}[Yi](t,e){const i=t.mode&4095||this.fmode,r=o=>{let a;try{m.closeSync(n)}catch(l){a=l}(o||a)&&this[P](o||a,t),e()};let n;try{n=m.openSync(t.absolute,Th(t.size),i)}catch(o){return r(o)}const h=this.transform&&this.transform(t)||t;h!==t&&(h.on("error",o=>this[P](o,t)),t.pipe(h)),h.on("data",o=>{try{m.writeSync(n,o,0,o.length)}catch(a){r(a)}}),h.on("end",o=>{let a=null;if(t.mtime&&!this.noMtime){const l=t.atime||new Date,c=t.mtime;try{m.futimesSync(n,l,c)}catch(u){try{m.utimesSync(t.absolute,l,c)}catch{a=u}}}if(this[ve](t)){const l=this[Ae](t),c=this[Me](t);try{m.fchownSync(n,l,c)}catch(u){try{m.chownSync(t.absolute,l,c)}catch{a=a||u}}}r(a)})}[Wi](t,e){const i=t.mode&4095||this.dmode,r=this[Pt](t.absolute,i);if(r){this[P](r,t),e();return}if(t.mtime&&!this.noMtime)try{m.utimesSync(t.absolute,t.atime||new Date,t.mtime)}catch{}if(this[ve](t))try{m.chownSync(t.absolute,this[Ae](t),this[Me](t))}catch{}e(),t.resume()}[Pt](t,e){try{return _h.sync(W(t),{uid:this.uid,gid:this.gid,processUid:this.processUid,processGid:this.processGid,umask:this.processUmask,preserve:this.preservePaths,unlink:this.unlink,cache:this.dirCache,cwd:this.cwd,mode:e})}catch(i){return i}}[gs](t,e,i,r){try{m[i+"Sync"](e,t.absolute),r(),t.resume()}catch(n){return this[P](n,t)}}}ir.Sync=Ca;var xa=ir;const Pa=Bh,xs=xa,Lh=v,Dh=ue,Sn=y,_i=As;var Ba=(s,t,e)=>{typeof s=="function"?(e=s,t=null,s={}):Array.isArray(s)&&(t=s,s={}),typeof t=="function"&&(e=t,t=null),t?t=Array.from(t):t=[];const i=Pa(s);if(i.sync&&typeof e=="function")throw new TypeError("callback not supported for sync tar functions");if(!i.file&&typeof e=="function")throw new TypeError("callback only supported with file option");return t.length&&Fa(i,t),i.file&&i.sync?$a(i):i.file?Ua(i,e):i.sync?ka(i):za(i)};const Fa=(s,t)=>{const e=new Map(t.map(n=>[_i(n),!0])),i=s.filter,r=(n,h)=>{const o=h||Sn.parse(n).root||".",a=n===o?!1:e.has(n)?e.get(n):r(Sn.dirname(n),o);return e.set(n,a),a};s.filter=i?(n,h)=>i(n,h)&&r(_i(n)):n=>r(_i(n))},$a=s=>{const t=new xs.Sync(s),e=s.file,i=Lh.statSync(e),r=s.maxReadSize||16*1024*1024;new Dh.ReadStreamSync(e,{readSize:r,size:i.size}).pipe(t)},Ua=(s,t)=>{const e=new xs(s),i=s.maxReadSize||16*1024*1024,r=s.file,n=new Promise((h,o)=>{e.on("error",o),e.on("close",h),Lh.stat(r,(a,l)=>{if(a)o(a);else{const c=new Dh.ReadStream(r,{readSize:i,size:l.size});c.on("error",o),c.pipe(e)}})});return t?n.then(t,t):n},ka=s=>new xs.Sync(s),za=s=>new xs(s);var Ga=Ba;class Ha{static getResourcesPath(){return y.join(U.app.getPath("userData"),"resources")}static getExtractedOpenClawPath(){return y.join(this.getResourcesPath(),"openclaw")}static async setupResources(){if(!U.app.isPackaged){console.log("[ResourceManager] Development mode, skipping resource extraction.");return}this.getResourcesPath();const t=this.getExtractedOpenClawPath(),e=y.join(process.resourcesPath,"bundled","openclaw.tar.gz");if(!v.existsSync(e)){console.warn(`[ResourceManager] Archive not found at ${e}. Ensure it is packed correctly.`);return}if(v.existsSync(y.join(t,"dist","entry.js"))){console.log("[ResourceManager] OpenClaw resources already present and seem valid.");return}console.log("[ResourceManager] Extracting bundled OpenClaw to user data..."),v.existsSync(t)||v.mkdirSync(t,{recursive:!0});try{await Ga({file:e,cwd:t,strip:1}),console.log("[ResourceManager] Extraction complete."),this.createCommandLinks()}catch(r){console.error("[ResourceManager] Failed to extract archive:",r)}}static createCommandLinks(){const t=this.getResourcesPath();if(process.platform==="win32"){const e=y.join(t,"openclaw.cmd");v.writeFileSync(e,`@ECHO OFF\r
node "%~dp0\\openclaw\\dist\\entry.js" %*`,"utf8"),console.log(`[ResourceManager] Created command link at ${e}`)}else{const e=y.join(t,"openclaw");v.writeFileSync(e,`#!/bin/sh
node "$(dirname "$0")/openclaw/dist/entry.js" "$@"`,{encoding:"utf8",mode:493}),console.log(`[ResourceManager] Created command link at ${e}`)}}}class Ya{static get isPackaged(){return U.app.isPackaged}static getGatewayStartCommand(){if(!this.isPackaged){const a=y.resolve(process.cwd(),"..","..");return console.log(`[NodeRuntime] Dev mode  pnpm openclaw gateway start (cwd: ${a})`),{command:"pnpm",args:["openclaw","gateway","start"],cwd:a}}const e=process.platform==="win32"?"node.exe":"node",i=y.join(process.resourcesPath,"bundled","node",e),r=v.existsSync(i)?i:"node",n=U.app.getPath("userData"),h=y.join(n,"resources","openclaw"),o=y.join(h,"openclaw.mjs");return console.log(`[NodeRuntime] Prod mode  ${r} openclaw.mjs gateway start (cwd: ${h})`),{command:r,args:[o,"gateway","start"],cwd:h}}}class Wa{constructor(t){Ft(this,"gatewayProcess",null);Ft(this,"port",18789);Ft(this,"isRestarting",!1);Ft(this,"stoppedByUser",!1);Ft(this,"maxRetries",5);Ft(this,"retryCount",0);this.onReady=t}async start(){var t,e;if(this.gatewayProcess){console.log("[GatewayManager] Gateway is already running.");return}this.stoppedByUser=!1;try{const{command:i,args:r,cwd:n}=Ya.getGatewayStartCommand();console.log("[GatewayManager] Starting Gateway..."),console.log(`[GatewayManager] Command: ${i} ${r.join(" ")}`),console.log(`[GatewayManager] CWD: ${n}`);const h={...process.env};this.gatewayProcess=xh.spawn(i,r,{env:h,cwd:n,stdio:"pipe",windowsHide:!0,shell:process.platform==="win32"}),(t=this.gatewayProcess.stdout)==null||t.on("data",o=>{console.log(`[Gateway stdout]: ${o.toString().trimEnd()}`)}),(e=this.gatewayProcess.stderr)==null||e.on("data",o=>{console.error(`[Gateway stderr]: ${o.toString().trimEnd()}`)}),this.gatewayProcess.on("exit",(o,a)=>{console.warn(`[GatewayManager] Process exited with code ${o}, signal ${a}`),this.gatewayProcess=null,!this.isRestarting&&!this.stoppedByUser&&this.handleUnexpectedCrash()}),this.waitForHealth()}catch(i){console.error("[GatewayManager] Failed to start gateway:",i)}}async stop(){this.isRestarting=!0,this.stoppedByUser=!0,this.gatewayProcess&&(console.log("[GatewayManager] Stopping gateway process..."),this.gatewayProcess.kill("SIGTERM"),await new Promise(t=>setTimeout(t,3e3)),this.gatewayProcess&&!this.gatewayProcess.killed&&(console.log("[GatewayManager] Force killing gateway process..."),this.gatewayProcess.kill("SIGKILL")),this.gatewayProcess=null),this.isRestarting=!1}handleUnexpectedCrash(){if(this.retryCount<this.maxRetries){this.retryCount++;const t=Math.min(5e3*this.retryCount,3e4);console.log(`[GatewayManager] Restarting gateway in ${t}ms (Attempt ${this.retryCount}/${this.maxRetries})...`),setTimeout(()=>{this.start()},t)}else console.error("[GatewayManager] Max restart retries reached. Gateway is dead.")}async waitForHealth(){const t=`http://127.0.0.1:${this.port}/health`,e=30;let i=0;const r=setInterval(()=>{if(this.stoppedByUser){clearInterval(r);return}i++,Ph.get(t,n=>{n.statusCode===200&&(clearInterval(r),this.retryCount=0,console.log(`[GatewayManager] Gateway is healthy at port ${this.port}`),this.onReady(`http://127.0.0.1:${this.port}`))}).on("error",()=>{i>=e&&(clearInterval(r),console.error(`[GatewayManager] Gateway failed health checks after ${e} attempts.`))})},1e3)}}let _=null,cs=null,Ns=null,rr=!1;U.app.on("before-quit",()=>{rr=!0});async function gn(){return _=new U.BrowserWindow({width:1280,height:800,title:"OpenClaw Control",webPreferences:{preload:y.join(__dirname,"preload.js"),nodeIntegration:!1,contextIsolation:!0},show:!1}),_.once("ready-to-show",()=>{_==null||_.show()}),_.on("close",s=>{if(!rr)return s.preventDefault(),_==null||_.hide(),!1}),process.env.VITE_DEV_SERVER_URL?_.loadURL(process.env.VITE_DEV_SERVER_URL):_.loadFile(y.join(__dirname,"../dist/index.html")),_}function Za(){try{const{nativeImage:s}=require("electron"),t=require("fs"),e=U.app.isPackaged?y.join(process.resourcesPath,"assets","icon.ico"):y.join(__dirname,"..","assets","icon.ico"),i=t.existsSync(e)?e:s.createEmpty();cs=new U.Tray(i),cs.setToolTip("OpenClaw Control Server");const r=U.Menu.buildFromTemplate([{label:" (Show Window)",click:()=>{_==null||_.show()}},{type:"separator"},{label:" (Exit)",click:async()=>{rr=!0,Ns&&(console.log("[Main] Stopping Gateway before exit..."),await Ns.stop()),U.app.quit()}}]);cs.setContextMenu(r),cs.on("double-click",()=>{_==null||_.show()})}catch(s){console.warn("[Main] Failed to create system tray:",s)}}U.app.whenReady().then(async()=>{console.log("[Main] App ready. Setting up resources..."),await Ha.setupResources();const s=await gn();Za(),Ns=new Wa(t=>{s&&!s.isDestroyed()&&s.webContents.send("gateway-ready",t)}),Ns.start(),U.app.on("activate",()=>{U.BrowserWindow.getAllWindows().length===0?gn():_==null||_.show()})});U.app.on("window-all-closed",()=>{});
