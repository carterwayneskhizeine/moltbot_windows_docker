# OpenClaw Electron 桌面应用项目计划

## 一、项目目标

将 OpenClaw 打造为一个独立的 Electron 桌面应用程序。该应用默认显示 OpenClaw Control UI 界面，具备系统托盘功能，关闭主窗口时最小化到托盘而不是退出应用。

## 二、项目位置

项目代码存放于仓库根目录下的 `apps/openclaw-electron` 文件夹中。

## 三、核心功能

### 3.1 界面展示

应用启动后，主窗口默认加载 OpenClaw Control UI，访问地址为本地 18789 端口的控制界面。用户可以在该界面中完成所有 OpenClaw 提供的操作。

### 3.2 Gateway 管理

应用启动时自动在后台启动 OpenClaw Gateway 进程，该进程负责提供 WebSocket 和 HTTP 服务。当用户关闭主窗口时，Gateway 进程不会被自动停止，，需要在托盘点击退出停止资源才会释放。

### 3.3 系统托盘

应用包含系统托盘功能。当用户点击窗口的关闭按钮时，主窗口会隐藏而不是退出应用，程序继续在后台运行。托盘区域会显示应用图标，用户可以通过以下方式与程序交互：

- 双击托盘图标：显示主窗口
- 右键点击托盘图标：弹出菜单，包含"显示窗口"和"退出"两个选项

选择"退出"选项时，会先停止 Gateway 进程，然后关闭应用。

### 3.4 OpenClaw 文件管理

应用的资源目录中包含一个 OpenClaw 压缩包文件。应用首次启动时，会自动检查并解压该压缩包到指定目录。解压后的文件包括 OpenClaw 的构建产物、入口文件和依赖模块，这些文件会被用于启动 Gateway 服务。

## 四、技术架构

### 4.1 Electron 主进程

主进程负责以下核心任务：

- 创建和管理应用窗口
- 在后台启动 Gateway 子进程
- 监听窗口事件并做出响应
- 管理系统托盘图标和菜单
- 应用退出时清理资源

### 4.2 BrowserWindow

应用使用单个 BrowserWindow 加载 OpenClaw Control UI。该窗口具备标准的窗口操作功能，包括最小化、最大化、关闭等。窗口的标题栏和尺寸可根据需要配置。

### 4.3 子进程管理

Gateway 进程作为主进程的子进程运行。主进程记录该子进程的 PID，当需要停止 Gateway 时，通过进程终止信号优雅地关闭它。如果进程未能及时响应，系统会强制终止。

### 4.4 资源打包

应用的打包配置中，只包含 OpenClaw 的压缩包文件，不直接包含解压后的文件列表。这种方式可以简化打包流程，减少打包时间，并降低打包过程中出现错误的概率。

## 五、打包与发布

### 5.1 打包配置

使用 electron-builder 进行应用打包。打包时会在 extraResources 配置中指定 OpenClaw 压缩包的位置，该压缩包会被复制到最终的应用资源目录中。

### 5.2 支持的平台

应用打包后支持以下平台：

- Windows 系统生成 NSIS 安装包
- macOS 系统生成 DMG 镜像
- Linux 系统生成 AppImage

### 5.3 压缩包准备

在打包之前，需要手动创建 OpenClaw 压缩包。该压缩包包含三个主要部分：dist 目录中的构建产物、openclaw.mjs 入口文件、以及 node_modules 依赖目录。创建完成后，将压缩包放置在项目指定的路径中，打包工具会自动将其包含进最终的应用里。

## 六、构建与运行

### 6.1 开发模式

在开发阶段，可以通过以下命令启动应用：首先进入项目目录，安装依赖，然后运行开发服务器。

### 6.2 生产打包

完成开发后，使用构建命令生成安装包。打包完成后，在 dist 目录中可以找到生成的安装文件。

## 七、实施步骤

### 第一步：创建项目结构

在 apps 文件夹下创建 openclaw-electron 目录，并在其中建立 src 文件夹用于存放源代码。

### 第二步：配置文件

在项目根目录创建 package.json 文件，配置应用的名称、版本、描述等信息，以及 electron-builder 的打包参数。配置中的 extraResources 部分指向预先准备好的 OpenClaw 压缩包。

### 第三步：实现主进程

在 src 目录下创建 main.js 文件，实现应用的主逻辑。主进程需要完成以下工作：检查并解压 OpenClaw 压缩包、创建应用窗口、启动 Gateway 子进程、设置系统托盘、处理窗口事件。

### 第四步：实现托盘逻辑

在 src 目录下创建 tray.js 文件，实现系统托盘的相关功能，包括托盘图标的创建、右键菜单的设置、以及菜单项点击事件的处理。

### 第五步：创建预加载脚本

在 src 目录下创建 preload.js 文件，用于在渲染进程和安全上下文之间建立桥梁，实现主进程和渲染进程之间的通信。

### 第六步：准备资源

手动创建 OpenClaw 压缩包，确保其中包含正确的文件结构，然后将压缩包放置在项目指定的路径中。

### 第七步：测试与打包

完成代码编写后，首先在开发模式下运行测试，确认各项功能正常工作。测试通过后，执行打包命令生成安装包。

## 八、关键路径参考

- OpenClaw 控制界面地址：本地 18788 端口的控制页面
- Gateway 默认端口：18789
- 压缩包解压目标目录：应用资源目录下的 openclaw 文件夹
